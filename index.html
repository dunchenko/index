<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-Content-Type-Options" content="nosniff">
    <meta name="referrer" content="strict-origin-when-cross-origin">
    <meta http-equiv="Permissions-Policy" content="camera=(), microphone=(), geolocation=()">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' https://www.googletagmanager.com; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com; font-src 'self' data: https://fonts.gstatic.com; img-src 'self' data: https://www.google-analytics.com; frame-src https://www.google.com/maps/; connect-src 'self' https://script.google.com/ https://script.googleusercontent.com/ https://www.google-analytics.com https://analytics.google.com https://api.ipify.org;">
    <meta name="description" content="Professional legal advocacy and notary services in Ontario. Specializing in Provincial Offences and Administrative Tribunals. Accessible, expert representation tailored to your needs.">
    <title>Hanna Dunchenko Paralegal Services | Ontario</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22 fill=%22%23ffffff%22>PS</text></svg>">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700;900&display=swap" rel="stylesheet">
    
    <!-- Google Analytics (GA4) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-ZMMKRZ3VBV"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());

        gtag('config', 'G-ZMMKRZ3VBV');
    </script>
    <style>
        /* Proportional Scaling for Mobile */
        html {
            font-size: min(16px, calc(100vw / 650 * 16));
        }
        body {
            font-size: 1rem;
        }

        /* ------------------- CORE STYLES ------------------- */
        :root {
            --bg-dark: #bfa792;
            --text-white: #ffffff;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.2);
            --placeholder-color: rgba(255, 255, 255, 0.6);
            --accent-gold: #6B5B4A;
            --accent-hover: #8B6F5A;
            --input-bg: rgba(255, 255, 255, 0.08);
        }

        * { 
            box-sizing: border-box; 
            margin: 0; 
            padding: 0; 
            font-family: 'Lato', sans-serif !important;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        @keyframes pulseText {
            0% { opacity: 0.4; }
            50% { opacity: 0.8; }
            100% { opacity: 0.4; }
        }

        .pulseText {
            animation: pulseText 2s infinite ease-in-out;
            font-weight: 500;
        }
        
        @keyframes blurReveal {
            0% { opacity: 0; }
            100% { opacity: 1; }
        }

        body { 
            font-family: 'Lato', sans-serif; 
            background-color: var(--bg-dark); 
            color: var(--text-white); 
            line-height: 1.6; 
            min-height: 100vh;
            padding-bottom: 9.375rem; /* Space for bottom bar */
            animation: blurReveal 4s ease-out forwards;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            text-rendering: optimizeLegibility;
        }

        /* Custom Scrollbar */
        html {
            scrollbar-width: thin; /* For Firefox */
            scrollbar-color: #5a3d2a transparent; /* thumb track */
        }
        body::-webkit-scrollbar {
            width: 0.5rem;
        }
        body::-webkit-scrollbar-track {
            background: transparent;
        }
        body::-webkit-scrollbar-thumb {
            background-color: #5a3d2a;
            border-radius: 0.625rem;
        }
        body::-webkit-scrollbar-thumb:hover {
            background-color: #6B5B4A;
        }
        ::-webkit-scrollbar-button { display: none; }

        /* Scroll Fade-in Animation */
        .fade-in-section {
            opacity: 1; /* Was 0 */
            transform: none; /* Was translateY(1.875rem) */
            transition: opacity 1s ease-out, transform 1s ease-out;
        }
        .fade-in-section.is-hidden {
            opacity: 0;
            transform: translateY(1.875rem);
        }
        .fade-in-section.is-visible {
            opacity: 1;
            transform: translateY(0);
        }

        .blur-in-section {
            opacity: 0;
            filter: blur(1.25rem); /* 20px */
            transition: opacity 1.5s ease-out, filter 1.5s ease-out;
            transform: none !important; /* Disable slide-up */
        }
        .blur-in-section.is-visible {
            opacity: 1;
            filter: blur(0);
        }

        /* ------------------- BLOCKS ------------------- */

        /* Block: background */
        .background { 
            position: fixed; 
            inset: 0; 
            z-index: -1; 
            overflow: hidden; 
            background: var(--bg-dark); 
        }

        .background__svg {
            width: 100%;
            height: 100%;
        }

        .background__stripe { 
            animation: anim-stripes 30s ease-in-out infinite; 
            will-change: transform; 
        }
        
        .background__stripe--delay-1 { animation-duration: 40s; animation-delay: -10s; }
        .background__stripe--delay-2 { animation-duration: 50s; animation-delay: -20s; }
        
        @keyframes anim-stripes {
            0%, 50%, 100% { transform: translate(0, 0) scaleX(1); }
            25% { transform: translate(2.5%, 1.5%) scaleX(1.06); }
            75% { transform: translate(-2.5%, -1.5%) scaleX(0.94); }
        }

        /* Pause background animation when a modal is open */
        body.modal-is-open .background__stripe {
            animation-play-state: paused;
        }
        
        /* Block: header */
        .header { 
            text-align: center; 
            padding: 2rem 1.25rem 2.5rem;
            max-width: 50rem;
            margin: 0 auto;
        }

        .header__title { 
            font-size: 3.5rem; 
            font-weight: 900; 
            margin-bottom: 0.9375rem;
            letter-spacing: 1px;
            text-transform: uppercase;
            white-space: nowrap;
        }

        .header__subtitle { 
            font-size: 4.5rem; 
            font-weight: 900; 
            text-transform: uppercase;
            opacity: 0.95;
            margin-bottom: 0.625rem;
        }

        .header__contact {
            margin: 0.3125rem 0 0.9375rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
        }

        .header__contact-label {
            font-size: 1.8rem;
            font-weight: 900;
            color: var(--text-white);
        }

        .header__phone-link { 
            font-size: 2.3rem; 
            font-weight: 900; 
            color: var(--text-white);
            text-decoration: none;
            transition: opacity 0.3s ease;
        }

        .header__phone-link:hover { opacity: 0.8; }

        /* Updated Header Content Styles */
        .header__content-block {
            margin: 3rem auto;
            text-align: left;
            max-width: 40.625rem;
            color: #ffffff;
            font-family: inherit;
        }

        .header__content-header {
            font-size: 2rem;
            font-weight: 900;
            margin: 3rem 0 1.5rem;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffffff;
            text-align: center;
        }

        .header__content-subheader {
            font-size: 1.4rem;
            font-weight: 900;
            margin: 2rem 0 1rem;
            color: #ffffff;
            text-transform: uppercase;
        }

        .header__content-text {
            font-size: 1.1rem;
            line-height: 1.7;
            margin-bottom: 1.5rem;
            color: #ffffff;
        }

        .header__content-text strong {
            color: #ffffff;
            font-weight: 800;
        }

        .header__description {
            font-size: 1.3rem;
            font-weight: 700;
            opacity: 0.85;
            margin: 2.1875rem auto;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            width: max-content;
            max-width: 100%; /* Prevent overflow on very narrow screens */
        }
        
        .header__description span {
            white-space: nowrap;
            width: 100%;
            text-align: justify;
            text-align-last: justify;
        }

        /* Block: layout-container */
        .layout-container { 
            max-width: 40.625rem; 
            margin: 0 auto 0; 
            padding: 0 1.25rem; 
        }
        
        /* Block: contact-form */
        .contact-form {
            width: 100%;
            background: transparent;
            border: none;
            padding: 0;
            box-shadow: none;
            border-radius: 0;
        }

        .contact-form__outside-title { 
            font-size: 1.8rem; 
            margin-bottom: 1.875rem; 
            text-align: center; 
            font-weight: 900; 
            text-transform: uppercase; 
            letter-spacing: 2px;
            color: var(--text-white);
        }

        .contact-form__title { 
            display: none;
            font-size: 1.8rem; 
            margin-bottom: 1.875rem; 
            text-align: center; 
            font-weight: 900; 
            text-transform: uppercase; 
            letter-spacing: 2px; 
        }

        .contact-form__group { 
            margin-bottom: 1.875rem; 
            position: relative; 
        }

        .contact-form__label-row { 
            display: flex; 
            justify-content: space-between; 
            margin-bottom: 0.5rem; 
        }

        .contact-form__label { 
            font-weight: 700; 
            text-transform: uppercase; 
            font-size: 0.85rem; 
            letter-spacing: 1px; 
        }

        .contact-form__input, 
        .contact-form__textarea, 
        .contact-form__select { 
            width: 100%; 
            padding: 1rem; 
            background: var(--input-bg); 
            border: 1px solid var(--glass-border); 
            border-radius: 0.625rem; 
            color: var(--text-white);
            font-size: 1rem; 
            outline: none; 
            transition: all 0.3s ease; 
            font-family: inherit; 
            -webkit-appearance: none;
            appearance: none;
            box-shadow: none; /* Remove iOS inner shadow */
        }

        .contact-form__input:focus, 
        .contact-form__textarea:focus, 
        .contact-form__input--has-content {
            background: #ffffff;
            color: var(--accent-gold);
            box-shadow: 0 2px 0.5rem rgba(0, 0, 0, 0.12);
            border-color: rgba(255, 255, 255, 0.5);
        }
        
        .contact-form__input::placeholder, 
        .contact-form__textarea::placeholder { 
            color: var(--placeholder-color); 
        }
        
        .contact-form__input:focus::placeholder, 
        .contact-form__textarea:focus::placeholder { 
            color: transparent; 
        }

        .contact-form__textarea { 
            resize: none; 
            min-height: 11.25rem; 
        }
        
        .contact-form__char-counter {
            font-size: 0.75rem;
            opacity: 0.6;
            color: rgba(255, 255, 255, 0.6);
            transition: all 0.3s ease;
        }

        .contact-form__group:has(.contact-form__textarea:focus) .contact-form__char-counter {
            color: var(--accent-hover);
            opacity: 0.9;
        }

        .contact-form__textarea-accessories {
            position: relative;
        }

        .contact-form__file-upload {
            position: absolute;
            bottom: 1.3125rem;
            right: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0.25rem;
            cursor: pointer;
            z-index: 2;
        }

        .contact-form__upload-icon {
            width: 1.5rem;
            height: 1.5rem;
            color: rgba(255, 255, 255, 0.5);
            stroke: currentColor;
            fill: none;
            transition: all 0.3s ease;
            display: block;
            stroke-width: 1.5;
            opacity: 0.7;
        }

        .contact-form__file-upload:hover { transform: scale(1.1); }
        .contact-form__file-upload:hover .contact-form__upload-icon { stroke: var(--text-white); }
        
        .contact-form__textarea:focus ~ .contact-form__textarea-accessories .contact-form__upload-icon,
        .contact-form__group:has(.contact-form__textarea:focus) .contact-form__upload-icon {
            stroke: var(--accent-hover);
        }

        .contact-form__checkbox-wrapper {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.9375rem;
            margin-top: 0.9375rem;
        }

        .contact-form__checkbox {
            width: 1.75rem; height: 1.75rem;
            padding: 0;
            appearance: none; -webkit-appearance: none;
            background: var(--input-bg);
            border: 1px solid var(--glass-border);
            border-radius: 0.5rem;
            cursor: pointer;
            display: grid; place-content: center;
            flex-shrink: 0;
        }

        .contact-form__checkbox:checked { 
            background: var(--accent-hover); 
            border-color: var(--accent-hover); 
        }
        
        .contact-form__checkbox:checked::before {
            content: ""; width: 0.375rem; height: 0.625rem; border: solid white; border-width: 0 2px 2px 0; transform: rotate(45deg); margin-top: -2px;
        }

        .contact-form__checkbox-label {
            font-size: 0.9rem;
            font-weight: 700;
            cursor: pointer;
        }
        
        .contact-form__terms-link {
            color: #ffffff;
            text-decoration: underline;
            cursor: pointer;
            transition: color 0.3s ease;
            font-weight: 700;
        }

        .contact-form__terms-link:hover { color: #D4B89A; }

        .contact-form__submit-button { 
            width: 100%; 
            padding: 1.25rem; 
            background: #5a3d2a;
            color: #ffffff; 
            border: none; 
            border-radius: 0.625rem; 
            font-weight: 900; 
            font-size: 1.1rem; 
            text-transform: uppercase; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            margin-top: 1.25rem;
            position: relative;
            box-shadow: 0 0.3125rem 0.9375rem rgba(0, 0, 0, 0.2);
        }
        
        .contact-form__submit-button:hover { 
            transform: translateY(-2px); 
            background: var(--accent-gold); 
            box-shadow: 0 0.5rem 1.25rem rgba(0, 0, 0, 0.25); 
        }

        /* Shadow Removal for Buttons inside Modals */
        .modal .contact-form__submit-button,
        .modal .contact-form__submit-button:hover {
            box-shadow: none !important;
        }

        .contact-form__note {
            text-align: center;
            font-size: 0.85rem;
            opacity: 0.75;
            margin-top: 0.9375rem;
        }

        /* Block: section-title */
        .section-title { 
            font-size: 1.8rem; font-weight: 900; 
            text-transform: uppercase; letter-spacing: 2px; 
            text-align: center; 
            margin: 5rem 0 2.5rem;
        }
        
        /* Block: faq */
        .faq { margin-top: 0; }

        .faq__item {
            margin-bottom: 1.875rem;
            padding: 0;
            text-align: left; /* Align FAQ content to the left */
        }
        
        .faq__item--no-bullet .faq__question::before {
            display: none;
        }

        .faq__item--no-bullet .faq__answer {
            padding-left: 0;
        }

        .faq__question { 
            font-weight: 900; 
            font-size: 1.1rem; 
            text-transform: uppercase; 
            display: flex; 
            align-items: flex-start; 
            gap: 0.9375rem; 
            cursor: pointer;
            margin-bottom: 0.9375rem;
            list-style: none;
        }

        .faq__question::-webkit-details-marker { display: none; }
        
        .faq__question::before { 
            content: ""; display: inline-block; 
            width: 0.75rem; height: 0.75rem; min-width: 0.75rem; 
            border-radius: 50%; border: 2px solid #ffffff; 
            margin-top: 0.3125rem; transition: background 0.3s;
        }
        
        details[open] > .faq__question::before { background-color: #ffffff; }

        .faq__answer { 
            font-size: 0.95rem; opacity: 0.9; 
            padding-left: 1.8125rem; 
            padding-bottom: 0.625rem;
            line-height: 1.6;
        }

        /* Block: price-table */
        .price-table { width: 100%; border-collapse: collapse; margin-top: 0.9375rem; border: 1px solid rgba(255,255,255,0.3); }
        .price-table td { padding: 0.75rem; border-bottom: 1px solid rgba(255,255,255,0.3); }
        .price-table td:last-child { text-align: right; font-weight: 700; }

        .price-note {
            font-size: 1rem; opacity: 0.9; display: block; margin-top: 0.625rem; text-align: left;
        }


        /* Block: modal */
        .modal {
            display: none; /* Hidden by default */
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(0.25rem);
            -webkit-backdrop-filter: blur(0.25rem);
            z-index: 20000; /* Increased to be above top-bar */
            align-items: center;
            justify-content: center;
            padding: 0.625rem;
            /* Ensure it covers screen */
            inset: 0;
            overflow-y: auto; /* Changed to auto to prevent unnecessary scrollbar */
        }

        #termsModal {
            z-index: 20001;
        }

        #termsModal .modal__content {
            max-width: 50rem;
            background: #121212; /* Solid dark background to cover underlying modal */
            border: 1px solid rgba(255, 255, 255, 0.15);
            box-shadow: 0 1.25rem 3.125rem rgba(0,0,0,0.5);
        }

        #termsModal .modal__title {
            text-align: center;
            color: var(--accent-gold);
            margin-bottom: 1.875rem;
            font-size: 2.2rem;
        }
        
        #termsModal .modal__section-title {
            color: #ffffff;
            font-size: 1.1rem;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            padding-bottom: 0.5rem;
            margin-top: 1.875rem;
            margin-bottom: 0.9375rem;
        }

        #termsModal .modal__text {
            color: rgba(255, 255, 255, 0.85);
            text-align: justify;
            margin-bottom: 0.9375rem;
        }

        #termsModal .modal__footer-text {
            text-align: center;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.9rem;
            margin-top: 2.5rem;
            border-top: 1px solid rgba(255,255,255,0.1);
            padding-top: 1.25rem;
            font-weight: 400;
        }

        /* When active, use Flexbox to center */
        .modal--active { 
            display: flex !important; 
            align-items: flex-start !important;
            justify-content: center !important;
            padding-top: 5vh;
            padding-bottom: 5vh;
        }

        .modal__content {
            background: var(--bg-dark);
            border: 1px solid var(--glass-border);
            border-radius: 0.9375rem;
            padding: 2.5rem;
            width: 100%;
            max-width: 37.5rem;
            text-align: center; /* Symmetrically center content */
            box-sizing: border-box;            
            display: flex;
            flex-direction: column;
            
            position: relative;
            box-shadow: 0 1.875rem 5.625rem rgba(0, 0, 0, 0.7), 0 0 1.25rem rgba(255, 255, 255, 0.05);
            animation: modalScaleIn 0.4s cubic-bezier(0.19, 1, 0.22, 1);
            
            /* Ensure it centers if flex alignment fails for some reason */
            margin: auto; /* Let flexbox handle centering perfectly */
        }

        @keyframes modalScaleIn {
            from { opacity: 0; transform: scale(0.95); }
            to { opacity: 1; transform: scale(1); }
        }

        .modal__close {
            position: absolute;
            top: 1.25rem;
            left: 1.25rem;
            right: auto;
            background: none;
            border: none;
            font-size: 1.75rem;
            color: var(--text-white);
            cursor: pointer;
            padding: 0;
            width: 2.5rem;
            height: 2.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: color 0.3s ease;
            z-index: 10;
        }

        .modal__close:hover { color: #D4B89A; }

        .modal__title {
            font-size: 1.4rem;
            font-weight: 900;
            margin-bottom: 0.9375rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            flex-shrink: 0;
        }

        .modal__body {
            font-size: 0.95rem;
            line-height: 1.7;
            color: var(--text-white);
            padding: 0 0.3125rem;
        }

        .modal__section-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-top: 1.25rem;
            margin-bottom: 0.625rem;
            text-transform: uppercase;
        }
        
        .modal__text { margin-bottom: 0.75rem; opacity: 0.95; }
        
        .modal__highlight { font-weight: 700; color: #D4B89A; }
        
        .modal__footer-text {
            margin-top: 1.875rem; 
            padding-top: 1.25rem; 
            border-top: 1px solid rgba(255, 255, 255, 0.2); 
            font-size: 1.15rem; 
            color: #ffffff; 
            font-weight: 700;
        }

        /* Block: footer */
        .footer {
            text-align: center;
            padding: 5rem 1.25rem 1.25rem;
            color: rgba(255, 255, 255, 0.8);
            font-size: 0.9rem;
            line-height: 1.8;
        }

        .footer__container { margin-bottom: 3.125rem; }
        
        .footer__button {
            width: 100%;
            padding: 1.25rem;
            background: #5a3d2a;
            color: #ffffff;
            border: none;
            border-radius: 0.625rem; 
            font-weight: 900;
            font-size: 1.1rem;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 0.3125rem 0.9375rem rgba(0, 0, 0, 0.2);
            max-width: 20rem;
            margin: 0 auto;
        }

        .footer__button:hover {
             transform: translateY(-2px); 
             background: var(--accent-gold); 
             box-shadow: 0 0.5rem 1.25rem rgba(0, 0, 0, 0.25); 
        }

        .footer__contact-link {
            display: block;
            color: #ffffff; 
            font-size: 1.8rem;
            font-weight: 900;
            text-decoration: none;
            margin: 1.875rem 0 0.625rem;
        }

        .footer__hours {
            font-size: 0.95rem; 
            color: #ffffff; 
            margin-bottom: 1.875rem;
            white-space: pre-line;
            line-height: 1.6;
        }

        /* Block: map-container */
        .map-container {
            width: 100%; 
            height: 28.125rem; 
            background-image: url('data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDAlIiBoZWlnaHQ9IjEwMCUiIHZpZXdCb3g9IjAgMCA4MDAgNDAwIiBwcmVzZXJ2ZUFzcGVjdFJhdGlvPSJub25lIj48cmVjdCB3aWR0aD0iODAwIiBoZWlnaHQ9IjQwMCIgZmlsbD0iI2UzZTNTzIiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZm9udC1mYW1pbHk9InNhbnMtc2VyaWYiIGZvbnQtc2l6ZT0iMjQiIGZpbGw9IiM1NTUiPk1hcCBMb2FkaW5nLi4uPC90ZXh0Pjwvc3ZnPg=='); 
            background-size: cover; 
            border-radius: 0.625rem; 
            overflow: hidden;
        }

        .map-container__iframe {
            border: 0;
            width: 100%;
            height: 100%;
        }


        /* ------------------- CUSTOM CALENDAR (Liquid Glass Design) ------------------- */
        .calendar-wrapper {
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(1.25rem);
            -webkit-backdrop-filter: blur(1.25rem);
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 0;
            padding: 2.5rem;
            margin-top: 0;
            /* Responsive Scaling */
            transform-origin: top center;
            transition: transform 0.3s ease;
        }
        
        .slots-block {
            padding: 0;
            margin-top: 0;
            display: none;
        }
        
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.875rem;
            text-align: center;
            padding: 0 0.625rem;
        }

        .calendar-title {
            font-size: 1.4rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffffff;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
            line-height: 1.2;
            display: flex;
            flex-direction: column;
            gap: 2px;
            align-items: center;
        }

        /* "Wait..." Animation */
        .loading-text {
            font-size: 1.2rem;
            font-weight: 700;
            color: rgba(255, 255, 255, 0.8);
            letter-spacing: 1px;
            animation: pulseText 1.5s infinite ease-in-out;
        }
        
        
        .calendar-title span { display: block; }
        .calendar-title .cal-month { font-size: 1.6rem; font-weight: 900; }
        .calendar-title .cal-year { font-size: 1.6rem; opacity: 0.9; font-weight: 900; letter-spacing: 2px; margin-top: -0.3125rem; }


        .calendar-nav-btn {
            background: rgba(255, 255, 255, 0);
            border: none;
            color: #ffffff; 
            border-radius: 0;
            width: 3.125rem; height: 3.125rem;
            cursor: pointer;
            font-size: 1.8rem;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.7;
        }

        .calendar-nav-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            transform: scale(1.1);
            opacity: 1;
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.75rem;
            text-align: center;
        }

        .cal-day-name {
            font-weight: 800;
            color: rgba(255, 255, 255, 0.6);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 0.9375rem;
        }

        .cal-day {
            aspect-ratio: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
            color: rgba(255, 255, 255, 0.7);
            background: rgba(255, 255, 255, 0.1); 
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            font-size: 1rem;
            border: 1px solid transparent;
            font-weight: 400; /* Normal weight */
        }

        .cal-day:hover:not(.cal-day--empty):not(.cal-day--disabled) {
            background: rgba(255, 255, 255, 0.25); /* Increased from 0.15 */
            border-color: rgba(255, 255, 255, 0.2);
            transform: translateY(-2px);
        }

        .cal-day--disabled {
            opacity: 0.4; /* Increased from 0.15 for better visibility while remaining inactive */
            cursor: default;
            pointer-events: none;
        }

        .cal-day--selected {
            background: #ffffff !important;
            color: #5a3d2a !important; /* Match Available Slot button color */
            mix-blend-mode: normal !important; /* Ensure visible */
            font-weight: 900;
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 0.25rem 0.75rem rgba(0, 0, 0, 0.2);
            transform: scale(1.05);
        }

        @keyframes pulseActive {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(224, 112, 32, 0.4); }
            70% { transform: scale(1.05); box-shadow: 0 0 0 0.625rem rgba(224, 112, 32, 0); }
            100% { transform: scale(1); box-shadow: 0 0 0 0 rgba(224, 112, 32, 0); }
        }

        .cal-day--saturday-available {
            opacity: 0.8;
            background: rgba(255, 255, 255, 0.05);
        }

        .cal-day--saturday-available .cal-num {
            display: none;
        }
        .cal-day--saturday-available.cal-day--selected .cal-key {
            display: none;
        }
        .cal-day--saturday-available.cal-day--selected .cal-num {
            display: inline;
        }

        .cal-key {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 1.375rem;
            height: 1.375rem;
            margin-top: 0.125rem; /* Visual compensation to push it down slightly */
        }

        .cal-key svg {
            width: 100%;
            height: 100%;
        }

        @keyframes keyWiggle {
            0%, 100% { transform: rotate(45deg); }
            25% { transform: rotate(40deg); }
            75% { transform: rotate(50deg); }
        }

        .cal-day--saturday-available:hover:not(.cal-day--disabled) .cal-key svg {
            animation: keyWiggle 0.5s ease-in-out infinite;
        }

        
        
        .cal-day--today {
            border: 0.35rem solid #ffffff; 
            box-shadow: 0 0 0.625rem rgba(255, 255, 255, 0.5) !important;
            opacity: 1 !important;
        }

        .cal-day--has-slots {
            background: rgba(255, 255, 255, 0.2);
            opacity: 1 !important;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        /* Slots Section */
        .slots-container {
            margin-top: 0;
            margin-bottom: 0.3125rem;
            padding-top: 0;
            display: block;
            position: relative;
        }

        /* Loading Progress Bar Separator */
        .loading-separator {
            position: absolute;
            top: 0;
            left: 10%; /* Centered at 80% width */
            width: 80%;
            height: 1px;
            background: rgba(255, 255, 255, 0.1); 
            overflow: hidden;
            opacity: 0; /* Hidden by default */
            transition: opacity 0.5s ease;
            
            -webkit-mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
            mask-image: linear-gradient(to right, transparent, black 15%, black 85%, transparent);
        }

        .loading-separator--active {
            opacity: 1;
        }

        /* Animated bar */
        .loading-separator::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 50%;
            height: 100%;
            background: linear-gradient(90deg, transparent, #ffffff, transparent);
            box-shadow: 0 0 0.9375rem rgba(255, 255, 255, 1);
            opacity: 0; /* Hidden by default */
            transition: opacity 0.8s ease-out; /* Smooth fade out */
            
            animation: loadingScan 1.5s infinite linear;
        }

        .loading-separator--active::after {
            opacity: 1;
        }

        @keyframes loadingScan {
            0% { transform: translateX(-100%); }
            15% { transform: translateX(200%); } /* Quick scan */
            100% { transform: translateX(200%); } /* Wait */
        }

        .loading-separator::after {
            animation: loadingScan 10s infinite linear; /* Run every 10s */
        }

        .slots-title {
            font-size: 1.4rem; /* Increased from 1.1rem */
            font-weight: 700; /* Increased from 600 */
            margin-bottom: 1.875rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: 0.5px;
            display: none; /* Hidden by default */
            animation: fadeTitle 0.5s ease forwards;
        }

        .cal-cta {
            font-size: 1.4rem; /* Increased from 1.1rem */
            font-weight: 700; /* Increased from 600 */
            margin-bottom: 1.875rem;
            text-align: center;
            color: rgba(255, 255, 255, 0.9);
            letter-spacing: 0.5px;
            display: none; /* Hidden by default */
        }

        @keyframes fadeTitle { from { opacity: 0; transform: translateY(0.625rem); } to { opacity: 1; transform: translateY(0); } }

        .slots-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 0.75rem;
        }

        .slots-grid .slot-btn {
            display: flex !important;
            flex-direction: row !important;
            align-items: center !important;
            justify-content: center !important;
            padding: 0.5rem 0.9375rem;
            height: clamp(3.75rem, 10vw, 4.6875rem);
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.15);
            color: rgba(255, 255, 255, 0.9);
            border-radius: 0;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1), box-shadow 0.6s ease, background-color 0.6s ease;
            font-family: 'Lato', sans-serif !important;
            backdrop-filter: blur(0.625rem);
            -webkit-backdrop-filter: blur(0.625rem);
            gap: 0.9375rem;
            box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
            width: 100%;
        }

        .slot-btn > div, .slot-btn > span {
            flex-grow: 0 !important;
            flex-shrink: 0 !important;
        }

        .slot-btn:hover {
            background: rgba(255, 255, 255, 0.2) !important;
            border-color: rgba(255, 255, 255, 0.6) !important;
            color: #ffffff !important;
            transform: translateY(-2px) !important;
            box-shadow: 0 0 20px rgba(255, 255, 255, 0.6), inset 0 1px 0 rgba(255,255,255,0.4) !important;
        }

        /* 25 Second Repeating Sequential Pulse Wave with Variable Speeds */
        @keyframes slotPulseWave {
            /* Pulse 1: Quick */
            0%, 2% {
                background: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.6);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6), inset 0 1px 0 rgba(255,255,255,0.4);
                transform: translateY(-2px);
            }
            4%, 28% {
                background: rgba(255, 255, 255, 0.05);
                border-color: rgba(255, 255, 255, 0.1);
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
                transform: translateY(0);
            }
            /* Pulse 2: Slow & Langurous */
            30%, 36% {
                background: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.6);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6), inset 0 1px 0 rgba(255,255,255,0.4);
                transform: translateY(-2px);
            }
            39%, 66% {
                background: rgba(255, 255, 255, 0.05);
                border-color: rgba(255, 255, 255, 0.1);
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
                transform: translateY(0);
            }
            /* Pulse 3: Lightning Fast */
            68%, 69% {
                background: rgba(255, 255, 255, 0.2);
                border-color: rgba(255, 255, 255, 0.6);
                box-shadow: 0 0 20px rgba(255, 255, 255, 0.6), inset 0 1px 0 rgba(255,255,255,0.4);
                transform: translateY(-2px);
            }
            71%, 100% {
                background: rgba(255, 255, 255, 0.05);
                border-color: rgba(255, 255, 255, 0.1);
                box-shadow: inset 0 1px 0 rgba(255,255,255,0.1);
                transform: translateY(0);
            }
        }

        .slot-btn:not(.slot-btn--busy) {
            animation: slotPulseWave 25s infinite;
            animation-delay: calc(var(--slot-idx) * 0.15s);
        }

        .slot-icon-wrapper {
            width: 2.5rem;
            height: 2.5rem;
            flex-shrink: 0;
        }

        .slot-icon-wrapper svg {
            width: 100% !important;
            height: 100% !important;
        }

        .slot-time {
            font-size: 0.95rem;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-align: center;
        }


        .slot-btn:hover::after {
            color: var(--accent-gold);
            border-color: var(--accent-gold);
        }


        @keyframes slideUpFade {
            from { opacity: 0; transform: translateY(0.9375rem); }
            to { opacity: 1; transform: translateY(0); }
        }

        @keyframes constantGlow {
            0% { 
                background: rgba(255, 255, 255, 0.25); 
                box-shadow: 0 0 0.9375rem rgba(255, 255, 255, 0.3);
                border-color: rgba(255, 255, 255, 0.5);
            }
            50% { 
                background: rgba(255, 255, 255, 0.15); 
                box-shadow: 0 0 0.3125rem rgba(255, 255, 255, 0.1);
                border-color: rgba(255, 255, 255, 0.25);
            }
        }


        @keyframes rotateIcon {
            0% { transform: rotate(0deg); }
            30% { transform: rotate(360deg); }
            100% { transform: rotate(360deg); }
        }

        .slot-icon-wrapper {
            display: inline-block;
            line-height: 0;
        }

        .clock-hand {
            transform-origin: 50% 50%;
            transform: rotate(var(--start));
        }

        .slot-btn--clicked .clock-hand {
            animation: none;
        }

        @keyframes handSweepClick {
            to { transform: rotate(var(--end)); }
        }

        @keyframes handRotateContinuous {
            from { transform: rotate(var(--start)); }
            to { transform: rotate(calc(var(--start) + 360deg)); }
        }

        .slot-btn:hover:not(.slot-btn--busy):not(.slot-btn--clicked) .minute-hand {
            animation: none;
        }
        .slot-btn:hover:not(.slot-btn--busy):not(.slot-btn--clicked) .hour-hand {
            animation: none;
        }

        .slot-btn--clicked {
            animation: none;
        }

        @keyframes btnClickScale {
            0% { transform: scale(1); }
            50% { transform: scale(0.95); }
            100% { transform: scale(1); }
        }


        /* Breathing Glow Animation */
        @keyframes breathingGlow {
            0% { 
                text-shadow: 0 0 0.3125rem rgba(255, 255, 255, 0.2); 
                opacity: 0.6; 
            }
            50% { 
                text-shadow: 0 0 1.25rem rgba(255, 255, 255, 0.8), 0 0 0.625rem rgba(255, 255, 255, 0.6); 
                opacity: 1; 
                color: #fff; 
            }
            100% { 
                text-shadow: 0 0 0.3125rem rgba(255, 255, 255, 0.2); 
                opacity: 0.6; 
            }
        }

        /* Loader */
        .calendar-loader {
            text-align: center;
            padding: 3.125rem;
            font-weight: 700;
            color: rgba(255,255,255,0.6);
            display: none;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            animation: breathingGlow 2s infinite ease-in-out;
        }
        /* Modal Specific Input Styles */
        .modal .contact-form__input,
        .modal .contact-form__textarea {
            text-align: left; /* Left align on all devices */
        }
        .modal .contact-form__input::placeholder,
        .modal .contact-form__textarea::placeholder {
            font-size: 0.8rem;
            opacity: 0.7;
            text-align: left;
        }



        /* Next Available Message */
        .next-available-msg {
            text-align: center;
            margin-top: 1.25rem;
            font-size: 1rem;
            color: #fff;
            font-weight: 700;
            opacity: 0;
            transition: opacity 0.5s ease;
        }
        .next-available-msg--visible { opacity: 1; }

        /* File Attachment Styles */
        .file-attach {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.9375rem;
            margin-top: 0.3125rem;
        }

        .file-attach__btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.75rem;
            width: 100%;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.08);
            border: 1px dashed rgba(255, 255, 255, 0.3);
            border-radius: 0.625rem;
            color: rgba(255, 255, 255, 0.7);
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: inherit;
            font-size: 0.95rem;
            font-weight: 600;
        }

        .file-attach__btn:hover {
            background: rgba(255, 255, 255, 0.15);
            border-color: rgba(255, 255, 255, 0.5);
            color: #fff;
        }

        /* Paperclip Attention Animation */
        @keyframes paperclipAttention {
            0%, 94% { transform: rotate(0deg) scale(1.1); }
            95% { transform: rotate(-30deg) scale(1.2); }
            96% { transform: rotate(25deg) scale(1.2); }
            97% { transform: rotate(-15deg) scale(1.2); }
            98% { transform: rotate(5deg) scale(1.2); }
            100% { transform: rotate(0deg) scale(1.1); }
        }

        .file-attach__icon-svg {
            display: inline-block;
            transform-origin: center center;
            animation: paperclipAttention 8s infinite ease-in-out;
        }

        .file-attach__icon {
            font-size: 1.6rem;
            line-height: 1;
            display: flex;
        }

        .file-attach__list {
            width: 100%;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .file-attach__item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.625rem 0.875rem;
            background: rgba(255, 255, 255, 0.08);
            border-radius: 0.5rem;
            font-size: 0.85rem;
            color: rgba(255, 255, 255, 0.9);
            position: relative;
            overflow: hidden;
        }

        .file-attach__name {
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            max-width: 80%;
        }

        .file-attach__remove {
            background: none;
            border: none;
            color: rgba(255, 255, 255, 0.5);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 0 0.25rem;
            transition: color 0.3s;
        }

        .file-attach__remove:hover {
            color: #ff6b6b;
        }

        .file-attach__progress {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 0.1875rem;
            background: rgba(255, 255, 255, 0.6);
            width: 0%;
            transition: width 0.5s ease-out;
        }

        /* Custom Dropdown (Select Replacement) */
        .custom-select-wrapper {
            position: relative;
            user-select: none;
            width: 100%;
            margin-bottom: 1.25rem;
        }

        .custom-select {
            position: relative;
            display: flex;
            flex-direction: column;
        }

        .custom-select__trigger {
            position: relative;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0.875rem 1.5625rem;
            padding-right: 2.8125rem; /* Space for arrow */
            font-size: 1rem;
            color: rgba(80, 60, 40, 0.9);
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 1.5625rem;
            cursor: pointer;
            transition: all 0.3s ease;
            box-sizing: border-box;
        }

        /* Arrow indicator */
        .custom-select__trigger::after {
            content: '';
            position: absolute;
            right: 1.125rem;
            top: 50%;
            transform: translateY(-50%);
            width: 1rem; height: 1rem;
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%238B6F5A' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
            background-repeat: no-repeat;
            background-size: contain;
            transition: transform 0.3s ease;
        }

        .custom-select.open .custom-select__trigger {
            background: rgba(139, 111, 90, 0.8);
            color: #ffffff;
        }

        .custom-select.open .custom-select__trigger::after {
            transform: translateY(-50%) rotate(180deg);
            background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='24' height='24' viewBox='0 0 24 24' fill='none' stroke='%23ffffff' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'%3E%3Cpolyline points='6 9 12 15 18 9'%3E%3C/polyline%3E%3C/svg%3E");
        }

        .custom-select__trigger span {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .custom-options {
            position: absolute;
            display: block;
            top: 100%;
            left: 0; right: 0;
            background: rgba(255, 255, 255, 0.97);
            backdrop-filter: blur(1.25rem);
            -webkit-backdrop-filter: blur(1.25rem);
            border: none;
            border-radius: 1.5625rem; /* All corners rounded */
            box-shadow: 0 2px 0.5rem rgba(0, 0, 0, 0.4);
            z-index: 100;
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
            transform: translateY(0);
            transition: all 0.3s ease;
            max-height: none;
            overflow: visible;
            padding: 0.5rem 0;
        }

        .custom-select.open .custom-options {
            opacity: 1;
            visibility: visible;
            pointer-events: all;
            transform: translateY(0);
        }

        .custom-option {
            position: relative;
            display: block;
            padding: 0.75rem 1.5625rem;
            font-size: 1rem;
            color: rgba(80, 60, 40, 0.85);
            cursor: pointer;
            transition: background 0.2s;
            text-align: left;
        }

        .custom-option:hover, 
        .custom-option.selected {
            background-color: rgba(139, 111, 90, 0.12);
            color: #3a2a1a;
        }

        .custom-option.selected::after {
            content: '\2713';
            position: absolute;
            right: 1.125rem; top: 50%;
            transform: translateY(-50%);
            color: var(--accent-gold);
        }

        /* Sparks Animation for Footer Booking Button */
        @keyframes sparkle {
            0%, 100% { opacity: 0; transform: scale(0) translate(var(--tx), var(--ty)); }
            50% { opacity: 1; transform: scale(1) translate(var(--tx), var(--ty)); }
        }

        .footer-book-btn {
            position: relative;
            display: inline-block;
            padding: 0.625rem 1.25rem;
            background: transparent;
            color: #fff;
            font-size: 0.9rem;
            font-weight: 700;
            border: none;
            border-radius: 3.125rem;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            margin: 0 auto;
            overflow: visible;
            transition: transform 0.2s, box-shadow 0.2s;
            box-shadow: 0 0.5rem 2rem rgba(0, 0, 0, 0.1);
            isolation: isolate;
        }
        .footer-book-btn::before {
            content: '';
            position: absolute;
            inset: 0;
            background: rgba(90, 61, 42, 0.5);
            backdrop-filter: blur(0.625rem);
            -webkit-backdrop-filter: blur(0.625rem);
            border-radius: 3.125rem;
            border: none;
            z-index: -1;
            transition: background 0.2s;
        }
        .footer-book-btn:hover {
            transform: scale(1.05);
            box-shadow: 0 0.75rem 2.1875rem rgba(0, 0, 0, 0.15);
        }
        .footer-book-btn:hover::before {
            background: rgba(90, 61, 42, 0.75);
        }

        #headerBookBtn {
            padding: 1.5625rem 2.5rem !important;
            font-size: 1.3rem !important;
            width: auto !important;
            max-width: 90% !important;
        }

        #footerBookBtn {
            padding: 1.5rem 3rem !important;
            width: auto !important;
            min-width: 18.75rem !important; /* 300px equivalent */
            max-width: 95% !important;
        }

        .spark {
            position: absolute;
            width: 0.375rem; height: 0.375rem;
            border-radius: 50%;
            pointer-events: none;
            opacity: 0;
            background: #ffffff;
            z-index: -1; /* Start behind the button */
        }

        @keyframes sparkle {
            0% { transform: translate(0, 0) scale(0); opacity: 0; }
            30% { opacity: 1; }
            100% { transform: translate(var(--vx), var(--vy)) scale(1.8); opacity: 0; }
        }

        @keyframes hypnoticPulse {
            0% { text-shadow: 0 0 0.3125rem rgba(255, 255, 255, 0.2); opacity: 0.6; }
            50% { text-shadow: 0 0 1.25rem rgba(255, 255, 255, 0.9), 0 0 0.625rem rgba(255, 255, 255, 0.7); opacity: 1; color: #fff; }
            100% { text-shadow: 0 0 0.3125rem rgba(255, 255, 255, 0.2); opacity: 0.6; }
        }

        .hypnotic-text {
            animation: hypnoticPulse 1.5s infinite ease-in-out;
        }

        /* Day Navigation in Slots Section */
        .slots-nav {
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 2.5rem 0 1.875rem;
            padding: 0 0.625rem;
            width: 100%;
        }

        .slots-nav--loading .slots-nav-arrow {
            display: none;
        }

        .slots-nav-arrow {
            background: rgba(255, 255, 255, 0);
            border: none;
            color: #ffffff;
            font-size: 1.8rem; /* Consistent with calendar nav */
            cursor: pointer;
            width: 3.125rem;
            height: 3.125rem;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0;
            transition: all 0.3s ease;
            opacity: 0.7;
            user-select: none;
            padding: 0;
            line-height: 1;
        }

        .slots-nav-arrow:hover {
            background: rgba(255, 255, 255, 0.1);
            opacity: 1;
            transform: scale(1.1);
        }

        .slots-nav-arrow:active {
            transform: scale(0.95);
        }

        #slotsDayDisplay {
            font-size: 1.6rem;
            font-weight: 900;
            text-transform: uppercase;
            letter-spacing: 2px;
            color: #ffffff;
            text-shadow: 0 1px 1px rgba(0,0,0,0.1);
            text-align: center;
            flex-grow: 1;
            margin: 0;
            transition: opacity 0.5s ease, transform 0.5s ease;
            line-height: 1.2;
        }

        .dot-jump {
            display: inline-block;
            animation: dotJump 1.4s infinite ease-in-out both;
        }
        .dot-jump:nth-child(2) { animation-delay: 0.2s; }
        .dot-jump:nth-child(3) { animation-delay: 0.4s; }

        @keyframes dotJump {
            0%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-0.625rem); }
        }

        .fade-out {
            opacity: 0;
            transform: translateY(-0.625rem);
        }
        .fade-in {
            opacity: 1;
            transform: translateY(0);
        }

        /* Hypnotic Preloader Error Effect */
        .book-btn-preloader__text {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ff4c4c;
            font-size: 1.25rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.5s ease;
        }

        .book-btn-preloader__text.is-visible {
            opacity: 1;
        }

        @keyframes hypnoticPulse {
            0% { filter: drop-shadow(0 0 10px rgba(212, 184, 154, 0.5)); stroke: #D4B89A; transform: scale(1); }
            50% { filter: drop-shadow(0 0 30px rgba(255, 255, 255, 1)); stroke: #ffffff; transform: scale(1.05); }
            100% { filter: drop-shadow(0 0 10px rgba(212, 184, 154, 0.5)); stroke: #D4B89A; transform: scale(1); }
        }

        .book-btn-preloader--hypnotic .book-btn-preloader__progress {
            /* Keep it visually at 100% */
            stroke-dashoffset: 0 !important;
            animation: hypnoticPulse 1.5s ease-in-out infinite !important;
        }
        
        .book-btn-preloader--error .book-btn-preloader__progress {
            stroke: #ff4c4c !important;
            filter: drop-shadow(0 0 15px rgba(255, 76, 76, 0.8)) !important;
            animation: none !important;
            stroke-dashoffset: 0 !important; /* Force fully filled */
        }

        /* Book Button Error State */
        .book-btn-preloader--error .book-btn-preloader__circle {
            stroke: rgba(255, 51, 51, 0.15); /* Light red track */
            animation: pulseError 1.5s infinite ease-in-out;
        }

        @keyframes pulseError {
            0%, 100% { stroke-opacity: 0.5; stroke-width: 3; }
            50% { stroke-opacity: 1; stroke-width: 4; }
        }

        /* Hide Spinners on Number Inputs */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        input[type=number] {
            appearance: textfield;
            -moz-appearance: textfield;
        }

        /* Playful Jump Animation for Last Slot Text */
        @keyframes playfulJump {
            0%, 30%, 100% { transform: scale(1); }
            15% { transform: scale(1.02); }
        }

        /* ------------------- TOP BAR & NAVIGATION (Auto-hiding) ------------------- */
        .top-bar {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 7.5rem;
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(1.25rem);
            -webkit-backdrop-filter: blur(1.25rem);
            z-index: 10000;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            padding: 0.9375rem 1.25rem 0;
            border-bottom: 1px solid var(--glass-border);
            opacity: 0;
            transform: translateY(-100%);
            pointer-events: none;
            transition: opacity 2.5s ease-in-out, transform 2.5s ease-in-out;
            -webkit-mask-image: linear-gradient(to bottom, black, transparent);
            mask-image: linear-gradient(to bottom, black, transparent);
        }

        .top-bar--visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 2.5s ease-in-out, transform 2.5s ease-in-out;
        }

        .bottom-bar {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 7.5rem;
            background: rgba(255, 255, 255, 0.01);
            backdrop-filter: blur(1.25rem);
            -webkit-backdrop-filter: blur(1.25rem);
            z-index: 10000;
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            padding: 0 1.25rem 0.9375rem;
            border-top: 1px solid var(--glass-border);
            opacity: 0;
            transform: translateY(100%);
            pointer-events: none;
            transition: opacity 2.5s ease-in-out, transform 2.5s ease-in-out;
            -webkit-mask-image: linear-gradient(to top, black, transparent);
            mask-image: linear-gradient(to top, black, transparent);
        }

        .services-content {
            text-align: left;
            margin: 3.75rem 0;
            padding: 2.5rem;
        }
        .services-content ul {
            list-style: none;
            padding: 0;
        }
        .services-content li {
            padding-bottom: 1.875rem;
            margin-bottom: 1.875rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .services-content li:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .services-content h3 {
            color: var(--text-white);
            margin-bottom: 0.9375rem;
            font-size: 1.2rem;
            text-transform: uppercase;
            font-weight: 900;
        }
        .services-content p {
            opacity: 0.9;
            font-size: 0.95rem;
        }

        .bottom-bar--visible {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 2.5s ease-in-out, transform 2.5s ease-in-out;
        }

        /* Preloader for Book Button */
        .book-btn-preloader {
            display: grid;
            place-items: center;
            width: 11.25rem;
            height: 11.25rem;
            position: relative;
            margin: 0 auto;
            transition: opacity 0.5s ease, transform 0.5s ease;
        }

        .book-btn-preloader__text {
            font-size: 1rem;
            font-weight: 700;
            color: #fff;
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
            text-align: center;
            line-height: 1.3;
            z-index: 2;
            position: relative;
        }

        .book-btn-preloader__svg {
            position: absolute;
            top: 0; left: 0;
            width: 100%;
            height: 100%;
            transform: rotate(-90deg); /* Start from top */
            overflow: visible; /* Prevent glow from clipping square box */
        }

        .book-btn-preloader__circle {
            fill: transparent;
            stroke: rgba(255, 255, 255, 0.2);
            stroke-width: 12;
            backdrop-filter: blur(0.625rem);
            -webkit-backdrop-filter: blur(0.625rem);
        }

        .book-btn-preloader__progress {
            fill: none;
            stroke: #ffffff;
            stroke-width: 12;
            stroke-linecap: round;
            stroke-dasharray: 302; /* Circumference: 2 * pi * 48 */
            stroke-dashoffset: 302; 
            animation: 
                fillProgress 14s ease-out forwards,
                hypnoticCircleGlow 3s infinite ease-in-out 17s;
        }

        @keyframes fillProgress {
            0% { stroke-dashoffset: 302; }
            100% { stroke-dashoffset: 0; } 
        }

        @keyframes hypnoticCircleGlow {
            0%, 100% { filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.1)); }
            50% { filter: drop-shadow(0 0 0.9375rem rgba(255, 255, 255, 0.9)); }
        }

        .book-btn-container {
            position: relative;
            height: 11.25rem; /* Adjust height to fit preloader */
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 2.5rem auto;
        }

        .book-btn-wrapper .book-btn-container {
            margin: 1.25rem auto;
        }

        /* Scaling wrapper: lets the calendar keep its natural size,
           JS will shrink it via transform: scale() on small screens */
        .calendar-scale-wrapper {
            width: 100%;
            overflow: hidden; /* clip the scaled content neatly */
        }
        /* The inner box is what actually gets scaled */
        .calendar-scale-inner {
            transform-origin: top center;
            /* Add some bottom padding to ensure the 1px border is never clipped by subpixel scaling */
            padding-bottom: 0.3125rem; 
            /* height is adjusted by JS after scaling so the wrapper collapses
               to the visible (scaled) height, not the original height */
        }

        .footer__copyright { 
            font-size: 0.95rem; 
            margin-top: 1.25rem; 
            opacity: 0.8;
            transition: opacity 2s ease 1s; /* 1s delay */
        }
        
        /* Specialized fade-in class for elements needing a delay */
        .fade-in-delayed {
            opacity: 0;
            transform: translateY(15px);
            transition: opacity 2s ease 1s, transform 2s ease 1s; /* 1s delay */
        }

        .fade-in-delayed.is-visible {
            opacity: 1;
            transform: translateY(0);
        }
    </style>
</head>

<body id="top">

<!-- TOP BAR -->
<div class="top-bar">
</div>

<!-- BOTTOM BAR -->
<div class="bottom-bar">
</div>

<div class="background">
    <svg class="background__svg" viewBox="0 0 528 816" preserveAspectRatio="xMidYMid slice">
        <defs>
            <radialGradient id="g" cx="50%" cy="100%" r="100%">
                <stop offset="0" stop-color="#D4B89A"/><stop offset="1" stop-color="#8B6F5A"/>
            </radialGradient>
        </defs>
        <rect width="100%" height="100%" fill="url(#g)"/>
        <g style="mix-blend-mode:overlay" fill-opacity=".15">
            <path class="background__stripe" d="M-100 300L600-100V200L-100 600Z" fill="#fff"/>
            <path class="background__stripe background__stripe--delay-1" d="M-100 700L600 200V400L-100 900Z" fill="#000" fill-opacity=".2"/>
            <path class="background__stripe background__stripe--delay-2" d="M100-100L500 900H300L-100-100Z" fill="#fff" fill-opacity=".08"/>
        </g>
    </svg>
</div>

<header class="header fade-in-section">
    <div class="header__title dynamic-text" data-i18n="name">Hanna&nbsp;Dunchenko</div>
    <div class="header__subtitle dynamic-text" data-i18n="subtitle">Paralegal Services</div>
    <h1 class="header__description">
        <span data-i18n="desc1">Licensed Paralegal &amp; Notary Public Services</span> 
        <span data-i18n="desc2">Traffic Ticket Defense, LTB, WSIB Matters</span> 
        <span data-i18n="desc3">Toronto, Richmond Hill, Mississauga, London</span> 
        <span data-i18n="desc4">Online meetings are available province-wide</span>
    </h1>

    <div class="header__contact" style="margin-top: 0.5rem; margin-bottom: 2rem;">
        <a href="tel:+14372396833" class="header__phone-link dynamic-text">+1 (437) 239-6833</a>
    </div>

    <div class="book-btn-wrapper">
        <div class="book-btn-container">
            <div class="book-btn-preloader" id="headerBookBtnPreloader" style="position: absolute;">
                <svg class="book-btn-preloader__svg" viewBox="0 0 120 120">
                    <circle class="book-btn-preloader__circle" cx="60" cy="60" r="48"/>
                    <circle class="book-btn-preloader__progress" cx="60" cy="60" r="48"/>
                </svg>
                <div class="book-btn-preloader__text" style="text-align: center; line-height: 1.2;">Loading...</div>
            </div>
            <button class="footer-book-btn" id="headerBookBtn" onclick="bookNearestSlot()" style="opacity: 0; transform: scale(0.9); pointer-events: none;">
                <span id="headerBookBtnText">Book Your First<br>Available Appointment</span>
            </button>
        </div>
    </div>

    <div class="header__content-block">
        <h2 class="header__content-header" style="font-size: 2rem;">SERVICES</h2>
        
        <div class="header__service-item">
            <h3 class="header__content-subheader" style="margin-bottom: 5px;">Notary Public & Commissioner of Oaths</h3>
            <p class="header__content-text" style="font-size: 0.95rem; font-weight: 300;">Operating as a Commissioner of Oaths in Ontario involves strictly assessing documents to establish the required level of notarization or commissioning. This requires formally verifying the deponent's identity utilizing valid, government-issued identification. The process continues with administering oaths, affirmations, or solemn declarations for documents including, but not limited to, an <strong>Affidavit</strong>, a <strong>Statutory Declaration</strong>, or a <strong>Consent Letter for Children Travelling Abroad</strong>. Providing certification to verify documents as true copies of the original is also conducted, where legally permissible under Ontario regulations.</p>
        </div>

        <div class="header__service-item">
            <h3 class="header__content-subheader" style="margin-bottom: 5px;">WSIB & Workplace Injury Claims</h3>
            <p class="header__content-text" style="font-size: 0.95rem; font-weight: 300;">Providing representation for injured workers in matters involving the Workplace Safety and Insurance Board falls under the strict authorization of licensed Ontario paralegals. The procedure initiates with reviewing the workplace injury circumstances, strictly analyzing the <strong>Form 6 Worker's Report of Injury</strong> or any existing WSIB decisions. This encompasses assisting with comprehensive claim management, submitting required documentation, and actively advising on <strong>Loss of Earnings (LOE)</strong> or <strong>Non-Economic Loss (NEL)</strong> entitlements. In instances of dispute, services include directly representing clients at hearings to address <strong>Return to Work (RTW)</strong> obligations or formally appealing adverse decisions before the Workplace Safety and Insurance Appeals Tribunal (WSIAT).</p>
        </div>

        <div class="header__service-item">
            <h3 class="header__content-subheader" style="margin-bottom: 5px;">Provincial Offences & Traffic Ticket Defense</h3>
            <p class="header__content-text" style="font-size: 0.95rem; font-weight: 300;">Representing clients in Provincial Offences Court for matters under the <strong>Highway Traffic Act (HTA)</strong> is strictly authorized under the unique regulatory framework for Ontario paralegals. Counsel begins by formally requesting and critically examining the prosecuting officer's disclosure and evidence. This is followed by formulating a precise case strategy for defending charges such as speeding, careless driving, or stunt driving by exploring potential procedural or charter defenses. Efforts initially focus on pursuing resolution through negotiating with the municipal prosecutor to seek withdrawing charges or reducing penalties (e.g., demerit points). Should a negotiated resolution not be attainable, the process culminates in providing formal representation at the trial hearing.</p>
        </div>

        <div class="header__service-item">
            <h3 class="header__content-subheader" style="margin-bottom: 5px;">Landlord & Tenant Board (LTB)</h3>
            <p class="header__content-text" style="font-size: 0.95rem; font-weight: 300;">Holding a specific license enables Ontario paralegals to represent landlords and tenants before the Landlord and Tenant Board under the strict guidelines of the <strong>Residential Tenancies Act (RTA)</strong>. The procedure involves precisely preparing and serving statutory notices, such as an <strong>N4 Notice to End your Tenancy Early for Non-payment of Rent</strong> or an <strong>N12 Notice to End your Tenancy Because the Landlord, a Purchaser or a Family Member Requires the Rental Unit</strong>. This is followed by filing the appropriate application, such as an <strong>L1 Application to Evict a Tenant for Non-payment of Rent</strong> or a <strong>T2 Application about Tenant Rights</strong>. Furthermore, the process includes rigorously preparing documentary evidence and witness testimony, culminating in directly representing clients during case management hearings or formal eviction hearings before an LTB adjudicator.</p>
        </div>
    </div>

    <div class="header__content-block">
        <h2 class="header__content-header" style="font-size: 2rem;">Intake Notice</h2>
        
        <details class="faq__item faq__item--no-bullet" open>
            <summary class="faq__question" style="margin-top: 20px;">Intake Appointment</summary>
            <div class="faq__answer">
                <p class="header__content-text">Before we can confirm and book your intake appointment, it is strongly recommended that you be ready to present all documents relevant to your matter, such as contracts, agreements, court notices, orders or any other paperwork.</p>
                <p class="header__content-text">If you are uncertain whether a document is relevant, we can review it together. Copies of supporting documents should be prepared in advance, but originals may also be requested for verification.</p>
            </div>
        </details>

        <details class="faq__item faq__item--no-bullet" open>
            <summary class="faq__question" style="margin-top: 20px;">Identification Requirement</summary>
            <div class="faq__answer">
                <p class="header__content-text">At the time of your intake appointment, you must be ready to present any valid government-issued identification document and provide following information:</p>
                <p class="header__content-text">Full name; date of birth; home address and telephone number; occupation; and/or business address and business telephone number; organizations incorporation or business identification number and its place of issue.</p>
            </div>
        </details>
    </div>
</header>



<div class="layout-container">
    <div class="contact-form fade-in-section">
        <h2 class="contact-form__outside-title">NEXT AVAILABLE DAYS</h2>
        <div class="calendar-scale-wrapper" id="calendarScaleWrapper">
        <div class="calendar-scale-inner" id="calendarScaleInner">
        <div class="calendar-wrapper fade-in-section" id="bookingCalendar">
            
            <!-- Header Moved to Top -->
            <div class="calendar-header">
                <button class="calendar-nav-btn" id="prevBtn">&#10094;</button>
                <div class="calendar-title" id="monthDisplay">Month Year</div>
                <button class="calendar-nav-btn" id="nextBtn">&#10095;</button>
            </div>

            <!-- Progress bar -->
            <div id="loadingSeparator" class="loading-separator"></div>

            <div id="calendarLoader" class="calendar-loader">Loading availability...</div>

            <div class="calendar-grid" id="calendarGrid">

            </div>
            
            <div id="nextAvailableMsg" class="next-available-msg"></div>
            
            <!-- Day Navigation Header -->
            <div class="slots-nav slots-nav--loading">
                <span id="slotsDayDisplay" class="hypnotic-text">Connecting to server<span class="dot-jump">.</span><span class="dot-jump">.</span><span class="dot-jump">.</span></span>
            </div>

            <div class="slots-block">
                 <div class="slots-container" id="slotsContainer">
                    <div class="slots-grid" id="slotsGrid" style="grid-template-columns: 1fr;"></div>
                </div>
            </div>
        </div><!-- /calendar-wrapper -->
        </div><!-- /calendar-scale-inner -->
        </div><!-- /calendar-scale-wrapper -->
    </div>


    <h2 class="section-title fade-in-section" data-i18n="faqTitle">FAQ</h2>
    <div class="faq fade-in-section">
        <details class="faq__item" open>
            <summary class="faq__question">Is online as effective as in-person?</summary>
            <div class="faq__answer">
                Yes! Youll receive the same professional services, with the convenience of connecting remotely. All online consultations are available province-wide.
            </div>
        </details>

        <details class="faq__item" open>
            <summary class="faq__question">What are the symbols on the calendar?</summary>
            <div class="faq__answer">
                The keys on the calendar above indicate that the office is closed on those days. In exceptional circumstances, meetings may still be arranged by appointment and proceed with an in-person consultation to outline strategy and next steps.
            </div>
        </details>

        <details class="faq__item" open>
            <summary class="faq__question">Was there an earlier way to register?</summary>
            <div class="faq__answer">
                The prior registration process remains accessible at its original URL and existing links will continue to direct users to the original <a href="https://docs.google.com/forms/d/1brLzvNv2tR9jDvG4Z9vUZLvzzpgZHmOhHPZ7_x8g8Qo" target="_blank" rel="noopener noreferrer" style="color:white; text-decoration: underline;">Google Form</a>. Please note that Google registration is required there.
            </div>
        </details>

        <details class="faq__item" open>
            <summary class="faq__question">Privacy Policy?</summary>
            <div class="faq__answer">
                <p><strong>Data Collection:</strong> Personal details you submit (name, phone, email, case summary etc) are gathered through this form.</p>
                <p style="margin-top: 10px;"><strong>How It's Used:</strong> Your information helps deliver paralegal services, answer your questions, and maintain contact, with your consent.</p>
                <p style="margin-top: 10px;"><strong>Your Rights:</strong> Request access to or removal of your data by calling <strong><a href="tel:+14372396833" style="color: #ffffff; text-decoration: none;">+1 (437) 239-6833</a></strong> or emailing <strong><a href="mailto:paralegal@hannadunchenko.com" style="color: #ffffff; text-decoration: none;">paralegal@hannadunchenko.com</a></strong>.</p>
            </div>
        </details>

        <details class="faq__item" open>
            <summary class="faq__question">WHERE IS THE OFFICE?</summary>
            <div class="faq__answer">
                <p style="margin-bottom: 15px; font-size: 0.95rem; font-weight: 400; opacity: 0.9;">146 Thirtieth St, Suite 29, Toronto, ON M8W 3C4</p>
                <div class="map-container">
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d378393.2825310128!2d-80.40792372435779!3d43.21332219277207!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x882b362142436423%3A0x6a0532729e2f4772!2s146%20Thirtieth%20St%2C%20Suite%2029%2C%20Toronto%20ON%20M8W%203C4!5e0!3m2!1sen!2sca" class="map-container__iframe" allowfullscreen="" loading="eager"></iframe>
                </div>
                <div style="display: flex; align-items: center; gap: 8px; margin-top: 15px; flex-wrap: wrap;">
                    <span style="opacity: 1; font-size: 1.1rem; font-weight: 700; display: inline-block;">Just tap</span>
                    <a href="https://www.google.com/maps/dir//146+Thirtieth+St,+Suite+29,+Toronto,+ON+M8W+3C4" target="_blank" onclick="logDirectionsClick()" style="display: inline-flex; align-items: center; gap: 6px; padding: 10px 20px; background: rgba(255, 255, 255, 0.15); border: 1px solid rgba(255, 255, 255, 0.3); backdrop-filter: blur(10px); box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1); color: #fff; font-weight: 700; border-radius: 50px; text-decoration: none; font-size: 0.9rem; white-space: nowrap; transition: transform 0.2s;">Directions</a>
                    <span style="opacity: 1; font-size: 1.1rem; font-weight: 700; display: inline-block;">to start driving</span>
                </div>
            </div>
        </details>
    </div>
</div>

<!-- ----------------------------------------------------------- -->
<!-- TERMS OF SERVICE MODAL -->
<!-- ----------------------------------------------------------- -->
<div id="termsModal" class="modal">
    <div class="modal__content">
        <button class="modal__close" onclick="closeTermsModal()">&times;</button>
        <h2 class="modal__title" data-i18n="termsModalTitle">Terms of Service</h2>
        <div class="modal__body">
            <h3 class="modal__section-title" data-i18n="noLegalAdvice">1. No Legal Advice</h3>
            <p class="modal__text">The information provided on this website is for general informational purposes only and does not constitute legal advice. You should not rely on, or take or fail to take any action, based upon this information. Always seek the advice of a qualified legal professional licensed in your jurisdiction regarding your specific legal situation. This website is intended solely for intake purposes.</p>
            
            <h3 class="modal__section-title" data-i18n="noParalegalRelationship">2. No Paralegal-Client Relationship</h3>
            <p class="modal__text">Accessing or using this website, or contacting Hanna Dunchenko via email, phone, or the booking form, does not create a paralegal-client relationship. A professional relationship is only established upon the execution of a formal written Retainer Agreement signed by both parties.</p>
            
            <h3 class="modal__section-title" data-i18n="confidentiality">3. Confidentiality</h3>
            <p class="modal__text">While we respect your privacy, please be aware that information transmitted to us through this website or via email prior to the establishment of a formal paralegal-client relationship may not be privileged or confidential. Please avoid sending sensitive or confidential information until a retainer is in place.</p>
            
            <h3 class="modal__section-title" data-i18n="noGuarantee">4. No Guarantee of Results</h3>
            <p class="modal__text">In accordance with professional standards and applicable regulations, we do not and cannot guarantee the outcome of any legal matter. Past results are not indicative of future outcomes, and every case is unique.</p>
            
            <h3 class="modal__section-title" data-i18n="feesAndRetainers">5. Fees and Retainers</h3>
            <p class="modal__text">Fees for legal services are determined based on the scope and complexity of the matter and will be clearly outlined in a Retainer Agreement. All fees and billing practices comply with professional regulatory guidelines.</p>

            <h3 class="modal__section-title" data-i18n="limitationOfLiability">6. Limitation of Liability</h3>
            <p class="modal__text">Your use of this website is at your own risk. The content is provided "as is" without warranties of any kind. We are not liable for any damages arising from your use of this site.</p>

            <h3 class="modal__section-title" data-i18n="formSubmission">7. Form Submission & Response Disclaimer</h3>
            <p class="modal__text">Submitting the inquiry form on this website is for informational purposes only and allows us to review your case files. It does not guarantee that a case will be opened, nor does it guarantee a response. While we aim to reply within 48 hours, a response is not guaranteed, and no legal rights are preserved by the mere act of submission. To expedite your request, we strongly recommend contacting our paralegal by phone immediately after submitting this form.</p>

            <h2 class="modal__title" style="margin-top: 50px; margin-bottom: 20px; font-size: 1.8rem;" data-i18n="privacyPolicy">Privacy Policy</h2>

            <h3 class="modal__section-title" data-i18n="infoCollection">1. Information Collection</h3>
            <p class="modal__text">We collect personal information (such as name and contact details) only when you voluntarily provide it. This information is used solely to communicate with you and assess your potential legal needs.</p>

            <h3 class="modal__section-title" data-i18n="useOfInfo">2. Use of Information</h3>
            <p class="modal__text">Your data is used to facilitate communication and legal representation. We do not sell, trade, or otherwise transfer your personally identifiable information to outside parties.</p>

            <h3 class="modal__section-title" data-i18n="analyticsAds">3. Analytics & Advertising</h3>
            <p class="modal__text">This website uses services like Google Analytics, Google Ads, YouTube, and Facebook. These third-party vendors may use cookies to analyze traffic, serve relevant advertisements based on past visits, and improve user experience. You may opt out of personalized advertising by visiting Google's Ad Settings.</p>

            <h3 class="modal__section-title" data-i18n="contactUs">4. Contacting Us</h3>
            <p class="modal__text">If there are any questions regarding this privacy policy or if you wish to exercise your rights to access or delete your data, you may contact us at paralegal@hannadunchenko.com.</p>

            <p class="modal__footer-text">
                By using this website, you acknowledge that you have read and understood these Terms of Service.
            </p>
        </div>
    </div>
</div>

<footer class="footer fade-in-section">
    <div class="footer__container">
        
        <div class="footer__hours" data-i18n="hours">
            <strong>Hours of Operation:</strong><br>Sunday: Closed<br>Monday - Saturday: 10:00 AM - 4:00 PM
        </div>

        <!-- Nearest Available Day Booking Button -->
        <div style="text-align: center; margin: 10px 0;">
            <div class="book-btn-container">
                <div class="book-btn-preloader" id="footerBookBtnPreloader" style="position: absolute;">
                    <svg class="book-btn-preloader__svg" viewBox="0 0 120 120">
                        <circle class="book-btn-preloader__circle" cx="60" cy="60" r="48"/>
                        <circle class="book-btn-preloader__progress" cx="60" cy="60" r="48"/>
                    </svg>
                    <div class="book-btn-preloader__text" style="text-align: center; line-height: 1.2;">Loading...</div>
                </div>
                <button class="footer-book-btn" id="footerBookBtn" onclick="bookNearestSlot()" style="opacity: 0; transform: scale(0.9); pointer-events: none;">
                    <span id="footerBookBtnText">Book Your First<br>Available Appointment</span>
                </button>
            </div>
        </div>

        <a href="tel:+14372396833" class="footer__contact-link">+1 (437) 239-6833</a>
    </div>
    <div class="blur-in-section" style="margin-top: 300px;">
        <p class="footer__copyright" style="margin-bottom: 5px;">My only official website:</p>
        <p class="footer__copyright" style="margin-top: 0;">&copy; <span id="currentYear"></span> Hanna Dunchenko Paralegal Services</p>
    </div>
</footer>

<!-- BOOKING MODAL -->
<div id="bookingModal" class="modal">
    <div class="modal__content" style="max-width: 600px;">
        <button class="modal__close" onclick="closeBookingModal()" style="left: 20px; right: auto;">&times;</button>
        <h2 class="modal__title" style="text-align: center; margin-top: 10px; margin-bottom: 20px; padding-top: 0; line-height: 1.4;">REQUEST<br><span style="display: block; font-size: 0.75em; opacity: 0.9; margin-top: 5px;">TO BOOK YOUR APPOINTMENT AT:</span><span id="modalAppointmentTime" style="display: block; font-size: 0.9em; font-weight: normal; margin-top: 2px;"></span></h2>
        <div class="modal__body" style="padding-top: 5px; text-align: center;">
            
            <form id="bookingForm" onsubmit="handleBookingSubmit(event)">
                <!-- Honeypot: hidden from humans, visible to bots -->
                <div style="position: absolute; left: -9999px; top: -9999px;" aria-hidden="true">
                    <input type="text" name="website" tabindex="-1" autocomplete="off">
                </div>
                <input type="hidden" name="_timestamp" id="formTimestamp">
                
                <div class="contact-form__group">
                    <input type="text" class="contact-form__input" placeholder="Your Name" name="name" required>
                </div>
                <div class="contact-form__group">
                    <input type="text" class="contact-form__input" placeholder="Your Occupation" name="occupation" required>
                </div>
                <div class="contact-form__group">
                    <input type="email" class="contact-form__input" placeholder="Your Email" name="email" required>
                </div>

                <div class="contact-form__group">
                    <div class="custom-select-wrapper">
                        <div class="custom-select" id="customSelect">
                            <button class="custom-select__trigger" type="button">
                                <span>Choose Service</span>
                            </button>
                            <div class="custom-options">
                                <div class="custom-option" data-value="public-notary">Public Notary Services</div>
                                <div class="custom-option" data-value="employment">Employment Law</div>
                                <div class="custom-option" data-value="civil">Civil matter</div>
                                <div class="custom-option" data-value="wsib">WSIB related issue</div>
                                <div class="custom-option" data-value="ltb">LTB related issue</div>
                                <div class="custom-option" data-value="other">Other</div>
                            </div>
                        </div>
                        <input type="hidden" name="service" id="serviceInput" value="">
                    </div>
                </div>

                <div class="contact-form__group">
                    <input type="tel" class="contact-form__input" placeholder="Phone Number" name="phone" required>
                </div>

                <div class="contact-form__group">
                    <input type="text" class="contact-form__input" placeholder="Street, City, ON, ZIP" name="address_full" required>
                </div>

                <div class="contact-form__group">
                    <textarea class="contact-form__textarea" placeholder="Brief details about your case area..." name="notes" style="min-height: 100px; text-align: left;"></textarea>
                    
                    <!-- File Attachment moved under Brief Case Area -->
                    <div class="file-attach" style="margin-top: 15px;">
                        <input type="file" id="fileAttachInput" multiple accept="image/*,.pdf,.doc,.docx" style="display: none;">
                        <button type="button" class="file-attach__btn" onclick="document.getElementById('fileAttachInput').click()">
                            <span class="file-attach__icon">
                                <svg class="file-attach__icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="width: 1.25em; height: 1.25em;">
                                    <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"></path>
                                </svg>
                            </span>
                            Attach files
                        </button>
                        <div class="file-attach__list" id="fileAttachList"></div>
                    </div>
                </div>

                <div class="contact-form__group">
                    <label class="contact-form__label" style="display:block; margin-bottom:8px; color:var(--text-white); text-align: center;">Date of Birth</label>
                    <div style="display: flex; gap: 10px; justify-content: center;">
                        <input type="number" class="contact-form__input" placeholder="YYYY" name="dob_year" style="width: 30%;" required>
                        <input type="number" class="contact-form__input" placeholder="MM" name="dob_month" style="width: 30%;" required>
                        <input type="number" class="contact-form__input" placeholder="DD" name="dob_day" style="width: 30%;" required>
                    </div>
                </div>

                <div class="contact-form__group">
                    <div class="contact-form__checkbox-wrapper" style="margin-bottom: 10px;">
                        <input type="checkbox" id="agreeTerms" class="contact-form__checkbox" required>
                        <label for="agreeTerms" class="contact-form__checkbox-label">
                            I read and agree with <span class="contact-form__terms-link" onclick="openTermsModal()">Terms of Service</span>
                        </label>
                    </div>
                </div>

                <script>
                    document.getElementById('agreeTerms').addEventListener('change', function() {
                        const modalBody = document.querySelector('#bookingModal .modal__body');
                        modalBody.scrollTop = modalBody.scrollHeight;
                    });
                </script>
                
                <p id="bookingStatus" style="text-align: center; margin-bottom: 15px; font-weight: 700; color: #ff6b6b; min-height: 1.5em;"></p>

                <button type="submit" class="contact-form__submit-button" id="confirmBookingBtn">Book Now</button>
                <p style="font-size: 0.8rem; text-align: center; opacity: 0.7; margin-top: 15px; text-transform: uppercase; letter-spacing: 0.5px;">Attach any files you have</p>
            </form>
        </div>
    </div>
</div>

<!-- GLOBAL SPINNER FOR BOOKING SUBMISSION -->
<div id="globalSpinner" style="display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0, 0, 0, 0.75); backdrop-filter: blur(8px); -webkit-backdrop-filter: blur(8px); z-index: 30000; flex-direction: column; align-items: center; justify-content: center;">
    <div class="loader" style="width: 60px; height: 60px; border: 4px solid rgba(255,255,255,0.2); border-top-color: var(--text-white); border-radius: 50%; animation: spin 1s linear infinite;"></div>
    <p id="globalSpinnerText" style="color: var(--text-white); margin-top: 20px; font-weight: 700; font-size: 1.2rem; text-transform: uppercase; letter-spacing: 1px;">Sending booking...</p>
</div>
<style>
@keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
</style>

<!-- CONFIRMATION MODAL -->
<div id="confirmationModal" class="modal" style="z-index: 20002;">
    <div class="modal__content" style="max-width: 500px; text-align: center;">
        <div class="modal__body" style="padding-top: 15px;">
            <div id="confirmationCheckmark" style="color: var(--accent-gold); margin-bottom: 20px; position: relative; display: inline-block; width: 60px; height: 60px;">
                <svg width="60" height="60" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" style="filter: drop-shadow(0 0 10px rgba(90, 61, 42, 0.4));">
                    <polyline points="20 6 9 17 4 12"></polyline>
                </svg>
            </div>
            <p style="font-size: 0.95rem; line-height: 1.5; margin-bottom: 15px; text-align: left;">
                I confirm that all information provided in this form is true, accurate, and complete to the best of my knowledge. I acknowledge that I am fully responsible for any consequences that may arise from providing false, misleading, or incomplete information.
            </p>
            <p style="font-size: 0.95rem; line-height: 1.5; margin-bottom: 25px; text-align: left;">
                I hereby authorize the recipient of this form to collect, use, and disclose the personal or confidential information I have provided for the purposes of responding to my inquiry and communicating with me. I understand that my information will be handled in accordance with applicable privacy and data-protection laws.
            </p>
            <div id="confirmButtons" style="display: flex; flex-direction: column; gap: 15px; justify-content: center; margin-top: 25px;">
                <button type="button" class="contact-form__submit-button" id="confirmYesBtn" onclick="submitBookingAfterConfirm()" style="width: 100%; margin:0; animation: none;">YES</button>
                <button type="button" class="contact-form__submit-button" onclick="closeConfirmationModal()" style="width: 100%; margin:0; background: #bfa792; animation: none;">NO</button>
            </div>
        </div>
    </div>
</div>

<script>
    // ------------------------------------------------------------------
    // CONFIGURATION (ONF URL)
    // ------------------------------------------------------------------
    // REPLACE THIS URL WITH YOUR GOOGLE APPS SCRIPT WEB APP URL
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycby9oKmQIco1LLqX-BBdy54XxWmQHqCxWrFo4MZQyxr2Nur6DA7_5bmR5tEeLtqWV7sGtg/exec"; 
    // Example: "https://script.google.com/macros/s/AKfycbx.../exec"
    // ------------------------------------------------------------------

    let currentDate = new Date();
    let selectedDate = null;
    let absoluteNearestDate = null; // Store the absolute closest date with slots
    let nearestSlotData = null; // Store the first available slot data for header
    let nearestDayLastSlotData = null; // Store the last available slot data for footer
    let availableDaysCount = 0; // Total available days in current view
    // Clear cache on every fresh load to ensure user sees latest Google data
    let availableSlotsCache = {}; // Cache format: { "YYYY-M": [ {date: 5, text: "9:00 AM", iso: "..."} ] }

    const monthNames = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];


    let userIP = "Unknown";
    async function fetchUserIP() {
        try {
            const response = await fetch('https://api.ipify.org?format=json');
            const data = await response.json();
            userIP = data.ip;
        } catch(e) {}
    }
    fetchUserIP();

    function getDetailedDeviceInfo() {
        return `IP: ${userIP} | UA: ${navigator.userAgent} | Platform: ${navigator.platform} | Res: ${window.screen.width}x${window.screen.height} | Lang: ${navigator.language}`;
    }

    function getFingerprint() {
        // Simple persistent fingerprint using browser properties and localStorage
        let fp = localStorage.getItem('site_fp');
        if (!fp) {
            fp = 'fp_' + Math.random().toString(36).substr(2, 9) + '_' + Date.now();
            localStorage.setItem('site_fp', fp);
        }
        return fp;
    }

    let currentMapsLink = "";

    /**
     * Sends usage logs to the Google Apps Script spreadsheet.
     */
     async function logEvent(event, details = "", isSuspicious = false, mapsLink = "", severity = "") {
        try {
            // If mapsLink is provided, use it. Otherwise use the global one if exists.
            const finalMapsLink = mapsLink || currentMapsLink;
            
            fetch(APPS_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors", 
                body: JSON.stringify({
                    action: "log",
                    event: event,
                    details: details,
                    suspicious: isSuspicious,
                    fingerprint: getFingerprint(),
                    userInfo: getDetailedDeviceInfo(),
                    mapsLink: finalMapsLink,
                    severity: severity
                })
            });
        } catch (e) { /* silent fail */ }
    }

    // --- Global Error Logging ---
    window.addEventListener('error', function(e) {
        logEvent('Frontend Error', `${e.message} at ${e.filename}:${e.lineno}`, false, "", "critical");
    });
    window.addEventListener('unhandledrejection', function(e) {
        logEvent('Unhandled Promise Rejection', e.reason ? e.reason.toString() : 'Unknown Reason', false, "", "critical");
    });

    // elements
    const monthDisplay = document.getElementById('monthDisplay');
    const calendarGrid = document.getElementById('calendarGrid');
    const prevBtn = document.getElementById('prevBtn');
    const nextBtn = document.getElementById('nextBtn');
    const slotsContainer = document.getElementById('slotsContainer');
    const slotsGrid = document.getElementById('slotsGrid');
    const loader = document.getElementById('calendarLoader');

    // Input Visual State (keep white background if has text)
    const inputs = document.querySelectorAll('.contact-form__input, .contact-form__textarea');
    inputs.forEach(input => {
        input.addEventListener('input', () => {
            if(input.value.trim() !== '') input.classList.add('contact-form__input--has-content');
            else input.classList.remove('contact-form__input--has-content');
        });
    });

    // Terms of Service Modal
    function openTermsModal() {
        const modal = document.getElementById('termsModal');
        if (modal) {
            modal.classList.add('modal--active');
            document.body.style.overflow = 'hidden';
            document.body.classList.add('modal-is-open');
        }
    }

    function closeTermsModal() {
        const modal = document.getElementById('termsModal');
        if (modal) {
            modal.classList.remove('modal--active');
            document.body.style.overflow = 'auto';
            document.body.classList.remove('modal-is-open');
        }
    }

    // Init
    window.addEventListener('DOMContentLoaded', () => {
        // Initialize custom select dropdown
        initializeCustomSelects();
        attachFormAutoSave();
        
        // Set today as selected by default
        // Set selectedDate to Toronto's "Today"
        // 1. Get current time in Toronto
        const torontoNowStr = new Date().toLocaleString("en-US", {timeZone: "America/Toronto"});
        const torontoNow = new Date(torontoNowStr);
        
        // 2. Set selectedDate
        selectedDate = torontoNow; 
        
        document.getElementById('currentYear').textContent = new Date().getFullYear();
        renderCalendar();
        setupEventListeners();

        // Apply downscale for small screens
        scaleCalendar();
    });

    /**
     * Downscales the calendar section on small screens so proportions
     * look exactly like on the reference (desktop/loaded) image.
     * On wide screens no scaling is applied (scale = 1).
     */
    function scaleCalendar() {
        const inner = document.getElementById('calendarScaleInner');
        const wrapper = document.getElementById('calendarScaleWrapper');
        if (!inner || !wrapper) return;

        // Reset first to measure the natural width
        inner.style.transform = '';
        inner.style.width = '';
        wrapper.style.height = '';

        // Natural width of the calendar block (what it would be without scaling)
        const naturalWidth = inner.scrollWidth;
        // Available screen width (accounting for body padding/margin)
        const availableWidth = wrapper.offsetWidth;

        if (naturalWidth > availableWidth && availableWidth > 0) {
            const scale = availableWidth / naturalWidth;
            inner.style.transform = `scale(${scale})`;
            inner.style.transformOrigin = 'top left';
            inner.style.width = (naturalWidth) + 'px';
            // Collapse the wrapper to the scaled height so nothing below is pushed down
            // Increased buffer from 10px to 30px to prevent bottom border clipping
            const naturalHeight = inner.scrollHeight;
            wrapper.style.height = (naturalHeight * scale + 30) + 'px';
        } else {
            inner.style.transform = 'scale(1)';
            inner.style.width = '';
            wrapper.style.height = '';
        }
    }

    // Re-scale on window resize (orientation change etc.)
    window.addEventListener('resize', scaleCalendar);

    // Re-scale whenever the calendar content changes (slots load dynamically)
    const _calObserver = new MutationObserver(() => {
        // Debounce slightly to allow layout to settle
        clearTimeout(window._scaleTimer);
        window._scaleTimer = setTimeout(scaleCalendar, 80);
    });
    const _calTarget = document.getElementById('bookingCalendar');
    if (_calTarget) {
        _calObserver.observe(_calTarget, { childList: true, subtree: true, attributes: true });
    }


    function getClockIcon(timeRangeStr) {
        // Parse start time "10:00 AM" or "10:00 AM - ..."
        const startTime = timeRangeStr.split(/[-]/)[0].trim(); // Get "10:00 AM"
        
        let hours = 12;
        let minutes = 0;
        
        // Robust parsing for "10:00", "10:00 AM", "10 AM", "10"
        const timeMatch = startTime.match(/(\d+)(?::(\d+))?/);
        if (timeMatch) {
            hours = parseInt(timeMatch[1]);
            minutes = timeMatch[2] ? parseInt(timeMatch[2]) : 0;
        }
        
        // Calculate angles
        // Hour hand: (Hours % 12) * 30deg + Minutes * 0.5deg
        const hourAngle = ((hours % 12) * 30) + (minutes * 0.5);
        
        // Minute hand: Minutes * 6deg
        const minuteAngle = minutes * 6;

        // Duration 50 minutes
        const duration = 50;
        const endHourAngle = hourAngle + (duration * 0.5);
        const endMinuteAngle = minuteAngle + (duration * 6);
        
        // SVG parameters
        const cx = 25, cy = 25;
        
        return `<svg viewBox="0 0 50 50" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" style="width: 100%; height: 100%;">
            <!-- Outer Ring -->
            <circle cx="25" cy="25" r="23" stroke="currentColor" stroke-opacity="0.8" fill="none" stroke-width="2.5"></circle>
            
            <!-- Soft shadow/glow for the ring -->
            <circle cx="25" cy="25" r="23" stroke="currentColor" stroke-opacity="0.15" fill="none" stroke-width="5"></circle>

            <!-- Center Dot -->
            <circle cx="25" cy="25" r="2" fill="currentColor" stroke="none"></circle>
            
            <!-- Hour Hand (Triangular tip with rounded circular base) -->
            <path d="M25,23 C26.1,23 27,23.9 27,25 C27,26.1 26.1,27 25,27 C23.9,27 23,26.1 23,25 C23,24.7 23.1,24.4 23.2,24.2 L25,12 L26.8,24.2 C26.9,24.4 27,24.7 27,25 Z" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" class="clock-hand" style="--start:${hourAngle}deg; --end:${endHourAngle}deg;" />
            
            <!-- Minute Hand (Triangular tip with rounded circular base) -->
            <path d="M25,23.5 C25.8,23.5 26.5,24.2 26.5,25 C26.5,25.8 25.8,26.5 25,26.5 C24.2,26.5 23.5,25.8 23.5,25 C23.5,24.8 23.6,24.6 23.6,24.4 L25,8 L26.4,24.4 C26.4,24.6 26.5,24.8 26.5,25 Z" fill="currentColor" stroke="currentColor" stroke-width="1.5" stroke-linejoin="round" opacity="0.9" class="clock-hand" style="--start:${minuteAngle}deg; --end:${endMinuteAngle}deg;" />
        </svg>`;
    }

    function setupEventListeners() {
        if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() - 1);
                renderCalendar();
            });
        }
        if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                currentDate.setMonth(currentDate.getMonth() + 1);
                renderCalendar();
            });
        }
    }

    async function renderCalendar() {
        calendarGrid.innerHTML = '';
        slotsGrid.innerHTML = '';
        const headerTitle = document.getElementById('calendarHeaderTitle');
        if(headerTitle) headerTitle.innerHTML = "";

        const ctaMsg = document.getElementById('calCtaMsg');
        if(ctaMsg) ctaMsg.style.display = 'none';

        // Hide slots block during render/loading
        const slotsBlock = document.querySelector('.slots-block');
        if(slotsBlock) slotsBlock.style.display = 'none';

        // Show loading state when switching months
        const slotsDisplay = document.getElementById('slotsDayDisplay');
        if(slotsDisplay) {
            slotsDisplay.innerHTML = 'Connecting to server<span class="dot-jump">.</span><span class="dot-jump">.</span><span class="dot-jump">.</span>';
            slotsDisplay.classList.add('hypnotic-text');
        }
        const slotsNav = document.querySelector('.slots-nav');
        if(slotsNav) slotsNav.classList.add('slots-nav--loading');

        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();

        logEvent("Calendar Render", `${monthNames[month]} ${year}`);

        monthDisplay.innerHTML = `<span class="cal-month">${monthNames[month]}</span>`;

        const dayNames = ["Sun", "Mon", "Tue", "Fri", "Sat", "Thu", "Wed"];
        dayNames.forEach(day => {
            const div = document.createElement('div');
            div.className = 'cal-day-name';
            div.textContent = day;
            calendarGrid.appendChild(div);
        });

        const firstDay = new Date(year, month, 1);
        const startingDay = firstDay.getDay(); // 0-6
        const daysInMonth = new Date(year, month + 1, 0).getDate();

        // Padding
        for (let i = 0; i < startingDay; i++) {
            const div = document.createElement('div');
            div.className = 'cal-day cal-day--empty';
            calendarGrid.appendChild(div);
        }

        const KEY_SVG = `<svg width="1.375rem" height="1.375rem" viewBox="0 0 24 24" fill="none" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="transform: rotate(45deg);"><g><circle cx="7.5" cy="15.5" r="5.5"/><path d="M11.5 11.5L22 1M18 5l2 2M20 3l2 2"/></g></svg>`;

        for (let day = 1; day <= daysInMonth; day++) {
            const div = document.createElement('div');
            div.className = 'cal-day';
            div.dataset.day = day;
            
            // Reduce opacity by 3% for each subsequent day
            div.style.opacity = Math.max(0.1, 1 - (day * 0.03)).toFixed(2);
            
            const checkDate = new Date(year, month, day);
            const torontoNowStr = new Date().toLocaleString("en-US", {timeZone: "America/Toronto"});
            const torontoNow = new Date(torontoNowStr);
            torontoNow.setHours(0,0,0,0);
            
            const isPast = checkDate < torontoNow;
            const isSaturday = checkDate.getDay() === 6;
            const isSunday = checkDate.getDay() === 0;
            const isToday = checkDate.getTime() === torontoNow.getTime();

            if (isSaturday) {
                 div.innerHTML = `<span class="cal-key">${KEY_SVG}</span><span class="cal-num">${day}</span>`;
                 div.classList.add('cal-day--saturday-available');
                 if (isPast) div.style.opacity = '0.3'; // Override calculated opacity for past
            } else {
                 div.textContent = day;
            }

            if (isPast) {
                div.classList.add('cal-day--disabled');
                div.style.opacity = '0.3'; // Override calculated opacity for past
            } else if (isSunday) {
                 div.classList.add('cal-day--disabled');
            }
            
            if (!isPast) {
                 div.onclick = () => selectDate(day, div);
            }
            if(div.classList.contains('cal-day--disabled')) div.onclick = null;

            if (isToday) {
                div.classList.add('cal-day--today');
                div.style.opacity = '1'; // Force today to be fully visible
            }

            calendarGrid.appendChild(div);
        }

        // Fetch Availability
        if (APPS_SCRIPT_URL.includes("REPLACE")) {
            console.warn("Script URL not set");
        } else {
            await fetchAvailability(year, month);
            
            // Safety timeout: if loading message still showing after 10 seconds, clear it
            setTimeout(() => {
                const slotsDisplay = document.getElementById('slotsDayDisplay');
                if(slotsDisplay && slotsDisplay.classList.contains('hypnotic-text')) {
                    console.warn("Loading message timeout - forcibly clearing");
                    slotsDisplay.classList.remove('hypnotic-text');
                    slotsDisplay.textContent = 'Success! Select a date\nto see available times';
                }
            }, 10000);
        }
    }

    async function fetchAvailability(year, month, isRecursiveSearch = false) {
        const cacheKey = `${year}-${month}`;
        
        // Only show the visual loading separator if this is the primary calendar view
        if (!isRecursiveSearch) {
            const separator = document.getElementById('loadingSeparator');
            if(separator) separator.classList.add('loading-separator--active');
        }
        
        try {
            if (!availableSlotsCache[cacheKey]) {
                const response = await fetch(`${APPS_SCRIPT_URL}?year=${year}&month=${month}&_t=${Date.now()}`);
                const data = await response.json();
                console.log("Slots API Response:", data); // Debug log
                if (data.success && data.slots) {
                    availableSlotsCache[cacheKey] = data.slots; // Expecting [{date: 12, text: "9:00", iso: "..."}]
                } else {
                    availableSlotsCache[cacheKey] = []; // Empty array if no success or no slots
                    console.warn("No slots found for", year, month);
                }
            }
            
            // If this is a background search just to find the next available button date
            if (isRecursiveSearch) {
                const searchSlots = availableSlotsCache[cacheKey];
                const bgMonth = new Date(year, month, 1);
                bgMonth.setHours(0,0,0,0);
                
                const foundValid = searchSlots.some(slot => {
                     const slotDate = new Date(year, month, slot.date);
                     const minBookingDate = new Date();
                     minBookingDate.setDate(minBookingDate.getDate() + 2);
                     minBookingDate.setHours(0,0,0,0);
                     // Must not be a Saturday (6) and must not be busy
                     return slotDate >= minBookingDate && slotDate.getDay() !== 6 && slot.status !== 'busy';
                });

                if (foundValid) {
                     // Found it! Force a re-render of the footer button logic with this month's data
                     // Note: We don't change the calendar view itself, just the global button data.
                     extractNearestSlotData(year, month, searchSlots);
                     updateFooterBookBtn();
                } else {
                     // Still nothing. Keep looking into the next month.
                     // Cap search to +3 months to prevent infinite loops if they fully blocked off a year
                     const currentCheck = new Date(year, month, 1);
                     const limitCheck = new Date();
                     limitCheck.setMonth(limitCheck.getMonth() + 3);
                     if (currentCheck < limitCheck) {
                         let nextM = month + 1;
                         let nextY = year;
                         if (nextM > 11) { nextM = 0; nextY++; }
                         fetchAvailability(nextY, nextM, true);
                     }
                }
            } else {
                // Normal UI render
                updateCalendarWithAvailability(availableSlotsCache[cacheKey]);
            }

        } catch (e) {
            console.error("Error fetching slots", e);
            if (!isRecursiveSearch) {
                const slotsDisplay = document.getElementById('slotsDayDisplay');
                if(slotsDisplay) {
                    slotsDisplay.classList.remove('hypnotic-text');
                    slotsDisplay.textContent = 'Error loading availability';
                }
            }
        } finally {
            if (!isRecursiveSearch) {
                const separator = document.getElementById('loadingSeparator');
                if(separator) separator.classList.remove('loading-separator--active');
            }
        }
    }

    // Extracted helper to just find the next slot without touching the UI
    function extractNearestSlotData(year, month, slots) {
        if (!Array.isArray(slots)) return false;
        
        const minBookingDate = new Date();
        minBookingDate.setDate(minBookingDate.getDate() + 2);
        minBookingDate.setHours(0, 0, 0, 0);

        const slotsMap = {};
        slots.forEach(slot => {
            const slotDate = new Date(year, month, slot.date);
            slotDate.setHours(0, 0, 0, 0);
            if (slotDate >= minBookingDate) {
                if (!slotsMap[slot.date]) slotsMap[slot.date] = [];
                slotsMap[slot.date].push(slot);
            }
        });

        const today = new Date();
        today.setHours(0,0,0,0);
        const availableDays = Object.keys(slotsMap).map(Number).sort((a,b) => a-b);

        for (let d of availableDays) {
            const checkDate = new Date(year, month, d);
            if (checkDate >= today && checkDate.getDay() !== 6) {
                const hasAvailableSlot = slotsMap[d].some(s => s.status !== 'busy');
                if (hasAvailableSlot) {
                    absoluteNearestDate = checkDate; 
                    const availableSlots = slotsMap[d].filter(s => s.status !== 'busy');
                    nearestSlotData = availableSlots[0] || null;
                    nearestDayLastSlotData = availableSlots[availableSlots.length - 1] || null;
                    return true;
                }
            }
        }
        return false;
    }

    async function updateCalendarWithAvailability(slots) {
        if (!Array.isArray(slots)) {
            const slotsDisplay = document.getElementById('slotsDayDisplay');
            if(slotsDisplay && slotsDisplay.classList.contains('hypnotic-text')) {
                slotsDisplay.classList.remove('hypnotic-text');
                slotsDisplay.textContent = 'Success! Select a date\nto see available times';
            }
            return;
        }

        
        const dayElements = document.querySelectorAll('.cal-day:not(.cal-day--empty)');
        const slotsMap = {}; // date -> count
        const year = currentDate.getFullYear();
        const month = currentDate.getMonth();
        // Logic: Disable today and tomorrow (allow booking only from 2 days ahead)
        const minBookingDate = new Date();
        minBookingDate.setDate(minBookingDate.getDate() + 2);
        minBookingDate.setHours(0, 0, 0, 0);

        slots.forEach(slot => {
            // Create date object for this slot to compare
            const slotDate = new Date(year, month, slot.date);
            slotDate.setHours(0, 0, 0, 0);

            if (slotDate >= minBookingDate) {
                if (!slotsMap[slot.date]) slotsMap[slot.date] = [];
                slotsMap[slot.date].push(slot);
            }
        });

        let nearestDay = null;
        const today = new Date();
        today.setHours(0,0,0,0);
        const availableDays = Object.keys(slotsMap).map(Number).sort((a,b) => a-b);

        for (let d of availableDays) {
            const checkDate = new Date(year, month, d);
            // Skip Saturdays (6) for auto-selection, even if they have slots
            if (checkDate >= today && checkDate.getDay() !== 6) {
                const hasAvailableSlot = slotsMap[d].some(s => s.status !== 'busy');
                if (hasAvailableSlot) {
                    nearestDay = d;
                    absoluteNearestDate = checkDate; // Set global
                    // Store the first available (non-busy) slot data
                    const availableSlots = slotsMap[d].filter(s => s.status !== 'busy');
                    nearestSlotData = availableSlots[0] || null;
                    nearestDayLastSlotData = availableSlots[availableSlots.length - 1] || null;
                    break;
                }
            }
        }

        availableDaysCount = 0;
        let autoSelectedDay = false;
        
        dayElements.forEach(el => {
            const dayFn = parseInt(el.dataset.day);
            if (slotsMap[dayFn]) {
                el.classList.add('cal-day--has-slots');
                el.style.setProperty('--i', availableDaysCount++);
                el.dataset.slots = JSON.stringify(slotsMap[dayFn]);
                const allBusy = slotsMap[dayFn].every(s => s.status === 'busy');
                
                if (allBusy) {
                    el.classList.add('cal-day--busy');
                    el.style.pointerEvents = 'none';
                    el.style.opacity = '0.3';
                }
                
                if (!allBusy && nearestDay && dayFn === nearestDay) {
                     autoSelectedDay = true;
                     setTimeout(() => {
                        selectDate(dayFn, el, true);
                     }, 200);
                }

            } else {
                if (!el.classList.contains('cal-day--disabled') && !el.classList.contains('cal-day--saturday-available')) { // Protect KEYS (Saturdays)
                     el.classList.add('cal-day--disabled');
                     el.style.opacity = '0.3'; // Visual cue
                     el.onclick = null; // Remove click
                }
            }
        });
        
        if (!autoSelectedDay) {
            const slotsDisplay = document.getElementById('slotsDayDisplay');
            if(slotsDisplay && slotsDisplay.classList.contains('hypnotic-text')) {
                slotsDisplay.classList.remove('hypnotic-text');
                if (availableDaysCount > 0) {
                    slotsDisplay.textContent = 'Select an available day to see times.';
                } else {
                    slotsDisplay.textContent = 'No available slots this month.';
                }
            }
        }
        
        // If we didn't find ANY nearest day in this month's render, it means the whole month
        // is booked or passed. We MUST trigger a background search of the NEXT month 
        // to populate the global "Nearest Appointment" buttons.
        if (!nearestDay) {
            let nextM = month + 1;
            let nextY = year;
            if (nextM > 11) { nextM = 0; nextY++; }
            fetchAvailability(nextY, nextM, true);
        } else {
            // We found one, update the buttons normally
            updateFooterBookBtn();
        }

        initScrollIndicator();
    }

    function selectDate(day, element, isAutoSelection = false) {
        document.querySelectorAll('.cal-day').forEach(d => d.classList.remove('cal-day--selected'));
        element.classList.add('cal-day--selected');
        element.classList.remove('cal-day--nearest-free');

        selectedDate = new Date(currentDate.getFullYear(), currentDate.getMonth(), day);
        logEvent("Date Selected", selectedDate.toDateString());
        const headerTitle = document.getElementById('calendarHeaderTitle'); // Legacy
        if(headerTitle) headerTitle.innerHTML = "";

        const slotsDisplay = document.getElementById('slotsDayDisplay');
        const slotsNav = document.querySelector('.slots-nav');
        const needsLoadingDelay = !isAutoSelection;
        const slotsBlock = document.querySelector('.slots-block');
        
        if (needsLoadingDelay && slotsDisplay) {
            slotsDisplay.textContent = '';
            slotsDisplay.innerHTML = 'Connecting to server<span class="dot-jump">.</span><span class="dot-jump">.</span><span class="dot-jump">.</span>';
            slotsDisplay.classList.add('hypnotic-text');
            if(slotsNav) slotsNav.classList.add('slots-nav--loading');
            
            // Hide block while loading new day
            if(slotsBlock) slotsBlock.style.display = 'none';
        }

        setTimeout(() => {
            if(slotsNav) slotsNav.classList.remove('slots-nav--loading');
            
            // Show block when data is ready
            if(slotsBlock) slotsBlock.style.display = 'block';

            if(slotsDisplay) {
                slotsDisplay.classList.remove('hypnotic-text'); // Remove animation
                const options = { weekday: 'long' };
                
                const slotsData = element.dataset.slots ? JSON.parse(element.dataset.slots) : [];
                const availableCount = slotsData.filter(s => s.status !== 'busy').length;
                let weekdayName = selectedDate.toLocaleString('en-US', { weekday: 'short' });
                if (!weekdayName.endsWith(',')) weekdayName += ',';
                const dayNum = selectedDate.getDate();

                let weekdayText;
                if (availableCount > 0) {
                    weekdayText = `SLOTS FOR ${weekdayName} ${dayNum}:`;
                } else {
                    weekdayText = 'Please select another available day';
                }

                if (needsLoadingDelay) {
                    slotsDisplay.classList.add('fade-out');
                    setTimeout(() => {
                        slotsDisplay.textContent = weekdayText;
                        slotsDisplay.classList.remove('fade-out');
                        slotsDisplay.classList.add('fade-in');
                        setTimeout(() => slotsDisplay.classList.remove('fade-in'), 500);
                    }, 500);
                } else {
                    slotsDisplay.textContent = weekdayText;
                }
                slotsDisplay.style.opacity = '1';
            }

            slotsGrid.innerHTML = '';
            const slotsData = element.dataset.slots ? JSON.parse(element.dataset.slots) : [];

            if (selectedDate.getMonth() !== currentDate.getMonth()) {
                slotsGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: rgba(0,0,0,0.5); mix-blend-mode: overlay; margin-top: 10px;">Select a date in the current month to check availability.</p>`;
                return;
            }

            if (slotsData.length === 0) {
                const torontoNowStr = new Date().toLocaleString("en-US", {timeZone: "America/Toronto"});
                const torontoNow = new Date(torontoNowStr);
                
                const datePhrase = isAutoSelection ? "anymore for Today" : "for this date";

                slotsGrid.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #ffffff; font-weight: 700; font-size: 1.2rem; margin-top: 20px; line-height: 1.5;">No available slots ${datePhrase}.<br>Please select another day.</p>`;
                const titleEl = document.querySelector('.slots-title');
                if(titleEl) titleEl.style.display = 'none';
                const ctaMsg = document.getElementById('calCtaMsg');
                if(ctaMsg) {
                    ctaMsg.style.display = 'none';
                    ctaMsg.textContent = 'Please select a time slot to proceed.';
                }

            } else {
                const titleEl = document.querySelector('.slots-title');
                if(titleEl) titleEl.style.display = 'block';
                
                const allBusy = slotsData.every(s => s.status === 'busy');
                
                const ctaMsg = document.getElementById('calCtaMsg');
                if(ctaMsg) {
                    ctaMsg.style.display = 'block';
                    const availableCount = slotsData.filter(s => s.status !== 'busy').length;
                    let weekdayName = selectedDate.toLocaleString('en-US', { weekday: 'short' });
                    if (!weekdayName.endsWith(',')) weekdayName += ',';
                    const dayNum = selectedDate.getDate();
                    
                    if (availableCount > 0) {
                        ctaMsg.innerHTML = `SLOTS FOR ${weekdayName} ${dayNum}:`;
                    } else {
                        ctaMsg.innerHTML = 'Please select another available day';
                    }
                }

                const isThisNearestDay = absoluteNearestDate && 
                                        selectedDate.getFullYear() === absoluteNearestDate.getFullYear() &&
                                        selectedDate.getMonth() === absoluteNearestDate.getMonth() &&
                                        selectedDate.getDate() === absoluteNearestDate.getDate();

                slotsData.filter(s => s.status !== 'busy').forEach((slot, index) => {
                    const btn = document.createElement('button');
                    btn.className = 'slot-btn slot-btn--hypnotic'; 

                    const svgIcon = getClockIcon(slot.text);
                    
                    let rawTime = slot.text.split(/[-]/)[0].trim().toUpperCase(); 
                    // Ensure leading zero if hour is single digit
                    if (/^\d:/.test(rawTime)) {
                        rawTime = '0' + rawTime;
                    }
                    let endTime = getEndTime(rawTime).toUpperCase();

                    btn.innerHTML = `
                        <div class="slot-icon-wrapper">${svgIcon}</div>
                        <div class="slot-time"><span>${rawTime} - ${endTime}</span></div>
                    `; 
                    
                    btn.style.setProperty('--i', availableDaysCount + index);
                    btn.style.setProperty('--slot-idx', index);
                    
                    btn.onclick = () => {
                        btn.classList.add('slot-btn--clicked');
                        setTimeout(() => openBookingModal(slot), 600);
                    };
                    slotsGrid.appendChild(btn);
                });
            }
        }, needsLoadingDelay ? 600 : 0);
    }

    // Modal & Form Handling
    let liveDraftTimer = null;
    let selectedSlotData = null;
    const modal = document.getElementById('bookingModal');
    const bookingTimeDisplay = document.getElementById('bookingTimeDisplay');
    const bookingStatus = document.getElementById('bookingStatus');
    const confirmBtn = document.getElementById('confirmBookingBtn');

    function openBookingModal(slot, triggerAttach = false) {

        try {
            selectedSlotData = slot;
            logEvent("Form Opened", slot.text);
            const tsInput = document.getElementById('formTimestamp');
            if (tsInput) tsInput.value = Date.now().toString();

            if (!selectedDate) {
                console.error("Selected date is null");
                return;
            }

            const year = selectedDate.getFullYear();
            const month = String(selectedDate.getMonth() + 1).padStart(2, '0');
            const day = String(selectedDate.getDate()).padStart(2, '0');
            const dateFormatted = `${year}.${month}.${day}`;

            let startTime = slot.text;
            if (startTime && (startTime.includes('-') || startTime.includes(''))) {
                startTime = startTime.split(/[-]/)[0].trim();
            }
            
            let endTime = "1 hr later";
            try {
                endTime = getEndTime(startTime); 
            } catch(e) {
                console.warn("Could not calculate end time", e);
                logEvent('Time Calc Warning', e.message, false, "", "warning");
            }
            
            if(bookingTimeDisplay) {
                bookingTimeDisplay.textContent = `${dateFormatted} at ${startTime} - ${endTime}`;
            }
            
            const modalAppointmentTime = document.getElementById('modalAppointmentTime');
            if(modalAppointmentTime) {
                modalAppointmentTime.textContent = `${dateFormatted} at ${startTime} - ${endTime}`;
            }
            
            if(modal) {
                window.scrollTo(0, 0);
                modal.classList.add('modal--active');
                document.body.style.overflow = 'hidden';
                document.body.classList.add('modal-is-open');
            }

            if(bookingStatus) bookingStatus.textContent = '';
            if(confirmBtn) {
                confirmBtn.disabled = false;
                confirmBtn.textContent = 'Book Now';
            }
            
            loadFormData();

            if (triggerAttach) {
                setTimeout(() => {
                    const fileInput = document.getElementById('fileAttachInput');
                    if (fileInput) fileInput.click();
                }, 800);
            }

            // Start live drafting (Debounced on-demand saving)
            const form = document.querySelector('#bookingForm');
            if (form) {
                // Debounce helper to prevent network spam while typing
                function debounce(func, wait) {
                    let timeout;
                    return function(...args) {
                        clearTimeout(timeout);
                        timeout = setTimeout(() => func.apply(this, args), wait);
                    };
                }

                const triggerDraftSave = debounce(() => {
                    const formData = new FormData(form);
                    const draftData = {
                        action: 'draft',
                        name: sanitize(formData.get('name')),
                        email: sanitize(formData.get('email')),
                        phone: sanitize(formData.get('phone')),
                        service: sanitize(formData.get('service')),
                        notes: sanitize(formData.get('notes')),
                        userInfo: getDetailedDeviceInfo(),
                        fingerprint: getFingerprint(),
                        mapsLink: currentMapsLink
                    };

                    // Only send if at least one meaningful field is partially filled
                    if (draftData.name || draftData.email || draftData.phone || draftData.service || draftData.notes) {
                        fetch(APPS_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            body: JSON.stringify(draftData)
                        }).catch(e => console.error('Draft HTTP error:', e));
                    }
                }, 2000); // 2 seconds of zero typing before sending

                // Listen to any input changes inside the form
                form.addEventListener('input', triggerDraftSave);
                form.addEventListener('change', triggerDraftSave);
            }
        } catch (error) {
            console.error("Error opening booking modal:", error);
            alert("Sorry, could not open the booking form. " + error.message);
        }
    }

    function closeBookingModal() {

        const isSuccess = document.getElementById('successBody') !== null;
        if(modal) modal.classList.remove('modal--active');
        document.body.style.overflow = 'auto';
        document.body.classList.remove('modal-is-open');

        // If we just successfully booked, reload the page to refresh slots
        if (isSuccess) {
            setTimeout(() => {
                location.reload();
            }, 500);
        }
    }

    function closeTermsModal() {
        document.getElementById('termsModal').classList.remove('modal--active');
    }
    
    document.querySelectorAll('.contact-form__terms-link').forEach(link => {
        link.addEventListener('click', () => {
             document.getElementById('termsModal').classList.add('modal--active');
        });
    });

    // --- Security: sanitize user input before sending ---
    function sanitize(str) {
        if (typeof str !== 'string') return '';
        return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#x27;');
    }

    // File Attachment Handling
    const MAX_FILE_SIZE = 10 * 1024 * 1024;  // 10 MB per file
    const MAX_TOTAL_SIZE = 25 * 1024 * 1024; // 25 MB total
    const MAX_FILE_COUNT = 5;
    const ALLOWED_TYPES = ['application/pdf', 'image/jpeg', 'image/png', 'image/gif', 'image/webp',
        'application/msword', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'];

    let attachedFiles = [];
    const fileInput = document.getElementById('fileAttachInput');
    const fileListEl = document.getElementById('fileAttachList');

    function getTotalFileSize() {
        return attachedFiles.reduce((sum, f) => sum + f.size, 0);
    }

    if (fileInput) {
        fileInput.addEventListener('change', function() {
            const newFiles = Array.from(this.files);
            const rejected = [];
            newFiles.forEach(f => {
                if (attachedFiles.length >= MAX_FILE_COUNT) {
                    rejected.push(`${f.name}: max ${MAX_FILE_COUNT} files`);
                } else if (f.size > MAX_FILE_SIZE) {
                    rejected.push(`${f.name}: exceeds 10 MB`);
                } else if (getTotalFileSize() + f.size > MAX_TOTAL_SIZE) {
                    rejected.push(`${f.name}: total exceeds 25 MB`);
                } else if (ALLOWED_TYPES.length > 0 && !ALLOWED_TYPES.includes(f.type)) {
                    rejected.push(`${f.name}: unsupported file type`);
                } else {
                    attachedFiles.push(f);
                }
            });
            if (rejected.length > 0) {
                alert('Some files were rejected:\n' + rejected.join('\n'));
            }
            this.value = ''; // Reset input
            logEvent("Files Attached", `${attachedFiles.length} files`);
            renderFileList();
        });
    }

    function renderFileList() {
        if (!fileListEl) return;
        fileListEl.innerHTML = '';
        attachedFiles.forEach((file, i) => {
            const item = document.createElement('div');
            item.className = 'file-attach__item';
            const nameSpan = document.createElement('span');
            nameSpan.className = 'file-attach__name';
            nameSpan.textContent = `${file.name} (${(file.size / 1024).toFixed(0)} KB)`;
            item.appendChild(nameSpan);
            const removeBtn = document.createElement('button');
            removeBtn.type = 'button';
            removeBtn.className = 'file-attach__remove';
            removeBtn.textContent = '\u00D7';
            removeBtn.addEventListener('click', () => removeFile(i));
            item.appendChild(removeBtn);
            
            const progress = document.createElement('div');
            progress.className = 'file-attach__progress';
            item.appendChild(progress);

            fileListEl.appendChild(item);
        });
    }

    function removeFile(index) {
        attachedFiles.splice(index, 1);
        renderFileList();
    }

    async function processFiles() {
        const filesData = [];
        if (attachedFiles.length > 0) {
            if (globalSpinnerText) globalSpinnerText.textContent = 'Uploading files...';
            const fileItems = document.getElementById('fileAttachList').children;

            for (let i = 0; i < attachedFiles.length; i++) {
                const file = attachedFiles[i];
                if (fileItems[i]) {
                    const bar = fileItems[i].querySelector('.file-attach__progress');
                    if (bar) bar.style.width = '100%';
                }
                await new Promise(r => setTimeout(r, 300)); // Visual delay

                const base64 = await fileToBase64(file);
                filesData.push({
                    name: file.name,
                    type: file.type,
                    data: base64
                });
            }
        }
        return filesData;
    }

    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onload = () => resolve(reader.result.split(',')[1]); // Remove data:... prefix
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // Rate limiting: track last submission time
    let lastBookingTime = 0;

    // localStorage Form Data Management
    const FORM_STORAGE_KEY = 'bookingFormData';

    function saveFormData() {
        try {
            const form = document.getElementById('bookingForm');
            if (!form) return;
            
            const formData = new FormData(form);
            const data = {
                name: formData.get('name') || '',
                email: formData.get('email') || '',
                phone: formData.get('phone') || '',
                service: formData.get('service') || '',
                address_full: formData.get('address_full') || '',
                notes: formData.get('notes') || '',
                dob_year: formData.get('dob_year') || '',
                dob_month: formData.get('dob_month') || '',
                dob_day: formData.get('dob_day') || '',
                agreeTerms: document.getElementById('agreeTerms')?.checked || false
            };
            
            localStorage.setItem(FORM_STORAGE_KEY, JSON.stringify(data));
        } catch (err) {
            console.warn('Could not save form data:', err);
        }
    }

    function loadFormData() {
        try {
            const savedData = localStorage.getItem(FORM_STORAGE_KEY);
            if (!savedData) return;
            
            const data = JSON.parse(savedData);
            const form = document.getElementById('bookingForm');
            if (!form) return;
            
            // Populate form fields
            if (data.name) form.name.value = data.name;
            if (data.email) form.email.value = data.email;
            if (data.phone) form.phone.value = data.phone;
            if (data.address_full) form.address_full.value = data.address_full;
            if (data.notes) form.notes.value = data.notes;
            if (data.dob_year) form.dob_year.value = data.dob_year;
            if (data.dob_month) form.dob_month.value = data.dob_month;
            if (data.dob_day) form.dob_day.value = data.dob_day;
            
            if (data.agreeTerms) {
                document.getElementById('agreeTerms').checked = true;
            }
            
            // Restore service selection
            if (data.service) {
                const serviceInput = document.getElementById('serviceInput');
                if (serviceInput) serviceInput.value = data.service;
                
                const trigger = document.querySelector('.custom-select__trigger span');
                if (trigger) trigger.textContent = data.service;
                
                const options = document.querySelectorAll('.custom-option');
                options.forEach(opt => {
                    if (opt.textContent.trim() === data.service) {
                        opt.classList.add('selected');
                    } else {
                        opt.classList.remove('selected');
                    }
                });
            }
        } catch (err) {
            console.warn('Could not load form data:', err);
        }
    }

    function clearFormData() {
        try {
            localStorage.removeItem(FORM_STORAGE_KEY);
        } catch (err) {
            console.warn('Could not clear form data:', err);
        }
    }

    function attachFormAutoSave() {
        const inputs = document.querySelectorAll('#bookingForm input, #bookingForm textarea, #bookingForm select');
        inputs.forEach(input => {
            input.addEventListener('change', saveFormData);
            input.addEventListener('input', saveFormData);
        });
        // Also save when custom select changes
        const customOptions = document.querySelectorAll('.custom-option');
        customOptions.forEach(option => {
            option.addEventListener('click', () => {
                setTimeout(saveFormData, 100);
            });
        });
    }

    async function handleBookingSubmit(e) {
        e.preventDefault();
        const formData = new FormData(e.target);

        if (!formData.get('service')) {
            bookingStatus.style.color = '#ff6b6b';
            bookingStatus.textContent = 'Please choose a service from the list.';
            return;
        }

        // Age Validation: Must be 18+
        const dobYear = parseInt(formData.get('dob_year'));
        const dobMonth = parseInt(formData.get('dob_month'));
        const dobDay = parseInt(formData.get('dob_day'));
        
        const maxDays = new Date(dobYear, dobMonth, 0).getDate();
        if (dobDay < 1 || dobDay > maxDays || isNaN(dobDay)) {
            bookingStatus.style.color = '#ff6b6b';
            bookingStatus.textContent = 'Invalid date of birth. Please check the day and month.';
            return;
        }

        const today = new Date();
        let age = today.getFullYear() - dobYear;
        const m = (today.getMonth() + 1) - dobMonth;
        if (m < 0 || (m === 0 && today.getDate() < dobDay)) {
            age--;
        }

        if (age < 18) {
            bookingStatus.style.color = '#ff6b6b';
            bookingStatus.textContent = 'You must be at least 18 years old to book services.';
            return;
        }

        const now = Date.now();
        if (now - lastBookingTime < 60000) {
            bookingStatus.style.color = '#ff6b6b';
            bookingStatus.textContent = 'Please wait 60 seconds before booking again.';
            return;
        }
        
        pendingBookingData = formData;
        
        const confBtn = document.getElementById('confirmButtons');
        if (confBtn) confBtn.style.display = 'block';

        const cModal = document.getElementById('confirmationModal');
        if (cModal) {
            cModal.style.display = 'flex';
            cModal.classList.add('modal--active');
            document.body.style.overflow = 'hidden';
            document.body.classList.add('modal-is-open');

            // Burst of sparks from the center checkmark icon
            const checkIcon = document.getElementById('confirmationCheckmark');
            if (checkIcon) createSparks(checkIcon);
        }
    }

    let pendingBookingData = null;

    window.closeConfirmationModal = function() {
        const cModal = document.getElementById('confirmationModal');
        if (cModal) {
            cModal.classList.remove('modal--active');
            setTimeout(() => { cModal.style.display = 'none'; }, 300);
        }
    }

    window.submitBookingAfterConfirm = async function() {
        if (!pendingBookingData) return;
        const formData = pendingBookingData;
        
        // Hide confirmation box buttons
        document.getElementById('confirmButtons').style.display = 'none';
        
        // Show Global Full-Screen Blur Spinner
        const globalSpinner = document.getElementById('globalSpinner');
        const globalSpinnerText = document.getElementById('globalSpinnerText');
        if (globalSpinner) {
            globalSpinner.style.display = 'flex';
            if (globalSpinnerText) globalSpinnerText.textContent = 'Sending booking...';
        }
        
        // BUG FIX: Close the confirmation modal immediately so it doesn't stay as a "glitch" box behind/under the spinner
        closeConfirmationModal();

        if(typeof confirmBtn !== 'undefined' && confirmBtn) confirmBtn.disabled = true;

        try {
            const bookingData = {
                year: selectedSlotData.iso.split('T')[0].split('-')[0],
                month: parseInt(selectedSlotData.iso.split('T')[0].split('-')[1]) - 1,
                day: parseInt(selectedSlotData.iso.split('T')[0].split('-')[2]),
                hour: parseInt(selectedSlotData.iso.split('T')[1].split(':')[0]),
                minute: parseInt(selectedSlotData.iso.split('T')[1].split(':')[1]),
                
                name: sanitize(formData.get('name')),
                occupation: sanitize(formData.get('occupation')),
                email: sanitize(formData.get('email')),
                phone: sanitize(formData.get('phone')),
                service: sanitize(formData.get('service')),
                notes: sanitize(formData.get('notes')),
                dateStr: selectedSlotData.iso,
                dob: `${sanitize(formData.get('dob_year'))}-${sanitize(formData.get('dob_month'))}-${sanitize(formData.get('dob_day'))}`,
                address: sanitize(formData.get('address_full')),
                files: await processFiles(),
                
                fingerprint: getFingerprint(),
                userInfo: getDetailedDeviceInfo(),
                _honeypot: formData.get('website') || '',
                _timestamp: formData.get('_timestamp') || ''
            };

            if (globalSpinnerText) globalSpinnerText.textContent = 'Finalizing booking...';

            const response = await fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: JSON.stringify(bookingData),
            });
            
            const result = await response.json();
            
            if (result.success) {
                logEvent("Booking Success", selectedSlotData.iso);
                lastBookingTime = Date.now();
                if (liveDraftTimer) {
                    clearInterval(liveDraftTimer);
                    liveDraftTimer = null;
                }
                clearFormData();
                playSuccessSound(); // Play Sound
                const modalContent = modal.querySelector('.modal__content');
                modalContent.innerHTML = `
                    <button class="modal__close" onclick="closeBookingModal()" style="left: 20px; right: auto;">&times;</button>
                    <h2 class="modal__title" style="text-align: center; color: var(--accent-gold); margin-top: 20px;">Booking Request Sent!</h2>
                    <div class="modal__body" style="text-align: center; padding: 20px 10px; position: relative;" id="successBody">
                        <div style="font-size: 3rem; margin-bottom: 20px;">&#10003;</div>
                        <p style="font-size: 1.1rem; margin-bottom: 20px;">Thank you for your request.</p>
                        <hr style="border: 0; border-top: 1px solid rgba(255,255,255,0.2); margin: 20px 0;">
                        <p style="font-weight: 700; color: #fff; margin-bottom: 10px;">To speed up the process:</p>
                        <p style="opacity: 0.9; margin-bottom: 20px;">Call during business hours and mention you just submitted a request online.</p>
                        <a href="tel:+14372396833" class="contact-form__submit-button" style="display: block; text-decoration: none; text-align: center; line-height: 1.2; margin-top: 15px;">
                            Call +1 (437) 239-6833
                        </a>
                    </div>
                `;
                
                // Trigger fireworks in the success modal
                const successBody = document.getElementById('successBody');
                if (successBody) {
                    // Create multiple bursts for a bigger effect
                    for(let i=0; i<3; i++) setTimeout(() => createSparks(successBody), i * 300);
                }
                
                // Hide Global Spinner
                if (globalSpinner) globalSpinner.style.display = 'none';

                // Also close the confirmation modal if active
                closeConfirmationModal();

            } else {
                throw new Error(result.error || "Unknown error");
            }

        } catch (err) {
            console.error(err);
            // Hide Global Spinner
            const globalSpinner = document.getElementById('globalSpinner');
            if (globalSpinner) globalSpinner.style.display = 'none';

            bookingStatus.style.color = '#ff6b6b';
            bookingStatus.textContent = "Error: " + err.message;
            if(confirmBtn) confirmBtn.disabled = false;
            
            // Log this booking failure as a critical error
            logEvent('Booking Submit Error', err.message, false, "", "critical");
            
            // Ensure confirmation modal closes on error
            closeConfirmationModal();
        }
    }

    // ------------------------------------------------------------------
    // AUDIO SYSTEM (Glassy Chimes)
    // ------------------------------------------------------------------
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    
    function playTone(freq, type, duration, delay = 0) {
        if(audioCtx.state === 'suspended') audioCtx.resume();
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = type;
        osc.frequency.setValueAtTime(freq, audioCtx.currentTime + delay);
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime + delay);
        gain.gain.exponentialRampToValueAtTime(0.001, audioCtx.currentTime + delay + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start(audioCtx.currentTime + delay);
        osc.stop(audioCtx.currentTime + delay + duration);
    }

    function playSuccessSound() {
        playTone(523.25, 'sine', 1.5, 0);   // C5
        playTone(659.25, 'sine', 1.5, 0.1); // E5
        playTone(783.99, 'sine', 1.5, 0.2); // G5
        playTone(1046.50, 'sine', 2.5, 0.3); // C6
    }
    
    document.addEventListener('click', function initAudio() {
        if(audioCtx.state === 'suspended') {
            audioCtx.resume();
        }
        document.removeEventListener('click', initAudio);
    }, { once: true });

    // Heart animation and click counter on coffee cups
    let coffeeClicks = 0;
    
    const coffeeCupsEl = document.getElementById('coffeeCups');
    if (coffeeCupsEl) {
        coffeeCupsEl.addEventListener('click', function() {
      const heart = document.getElementById('heartAnimation');
      const counter = document.getElementById('coffeeLikeCount');
      
      coffeeClicks++;
      
      // Update counter text with the heart SVG
      const heartIcon = `<svg width="12" height="12" viewBox="0 0 24 24" fill="#a18570" stroke="white" stroke-width="1.5" style="vertical-align: -2px; margin-left: 4px;"><path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54L12 21.35z"/></svg>`;
      if (coffeeClicks >= 1000000) {
          counter.innerHTML = "Win Win!" + heartIcon;
      } else {
          counter.innerHTML = coffeeClicks.toLocaleString() + heartIcon;
      }
      
      // Heart Animation
      heart.style.transition = 'none';
      heart.style.transform = 'translate(-50%, -50%) scale(0)';
      heart.style.opacity = '1';
      
      // Counter Animation
      counter.style.transition = 'none';
      counter.style.transform = 'translateY(5px) scale(0.9)';
      counter.style.opacity = '1';
      
      requestAnimationFrame(() => {
        // Pop the heart (using custom bezier for a bounce effect)
        heart.style.transition = 'transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275), opacity 0.5s ease';
        heart.style.transform = 'translate(-50%, -50%) scale(1.6)'; // Bigger heart
        heart.style.opacity = '0';
        
        // Pop the counter
        counter.style.transition = 'all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275)';
        counter.style.transform = 'translateY(0) scale(1)';
        
        // Fade out slightly after a delay, or keep it visible
        setTimeout(() => {
            counter.style.transition = 'all 0.8s ease';
            if(coffeeClicks < 1000000) {
              counter.style.opacity = '0.7'; // Keeps it slightly visible when idle
            }
        }, 500);
        });
      });
    }

    function getEndTime(startTime) {
        try {
            const [time, modifier] = startTime.split(' ');
            let [hours, minutes] = time.split(':');
            
             const d = new Date();
             let h = parseInt(hours);
             if (modifier === 'PM' && h !== 12) h += 12;
             if (modifier === 'AM' && h === 12) h = 0;
             
             d.setHours(h);
             d.setMinutes(parseInt(minutes));
             // Add 50 minutes instead of 1 hour
             d.setMinutes(d.getMinutes() + 50);
             
             return d.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', hour12: true});
        } catch(e) {
            return "50 min later";
        }
    }
    function captureGeolocation(onSuccess, onError) {
        if ("geolocation" in navigator) {
            navigator.geolocation.getCurrentPosition(
                function(position) {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    currentMapsLink = `https://www.google.com/maps?q=${lat},${lon}`;
                    if (onSuccess) onSuccess(currentMapsLink);
                },
                function(error) {
                    let errorMsg = "Unknown Error";
                    if (error.code === error.PERMISSION_DENIED) errorMsg = "Permission Denied by User";
                    else if (error.code === error.POSITION_UNAVAILABLE) errorMsg = "Position Unavailable";
                    else if (error.code === error.TIMEOUT) errorMsg = "Request Timeout";
                    if (onError) onError(errorMsg);
                },
                { timeout: 10000 }
            );
        } else {
            if (onError) onError("Geolocation not supported by browser");
        }
    }

    window.addEventListener('load', () => {
        // Run UI adjustments and permission requests immediately so they don't cause late layout shifts
        adjustDynamicText();
        
        // Send the initial Page Load event asynchronously to guarantee correct row color
        logEvent("Page Load", window.location.href);
    });

    function scrollToCalendar() {
        const cal = document.getElementById('bookingCalendar');
        if (cal) cal.scrollIntoView({ behavior: 'smooth', block: 'center' });
        setTimeout(() => {
            const nearestEl = document.querySelector('.cal-day--nearest');
            if (nearestEl) nearestEl.click();
        }, 600);
    }

    function createSparks(container) {
        if (!container || container.dataset.sparkTimer) return;
        container.style.position = 'relative';
        container.dataset.sparkTimer = 'running';
        
        setInterval(() => {
            const spark = document.createElement('div');
            spark.className = 'spark';
            
            const angle = Math.random() * Math.PI * 2;
            
            // Start further away from center
            const randomRadius = 30 + Math.random() * 20; 
            const startX = Math.cos(angle) * randomRadius;
            const startY = Math.sin(angle) * randomRadius;

            spark.style.left = `calc(50% + ${startX}px)`;
            spark.style.top = `calc(50% + ${startY}px)`;
            spark.style.transform = 'translate(-50%, -50%)'; // Ensure origin is relative

            // Targeted velocity away from start point (center explosion)
            const velocity = 50 + Math.random() * 80; // Faster moving
            const vx = Math.cos(angle) * velocity;
            const vy = Math.sin(angle) * velocity;
            
            spark.style.setProperty('--vx', vx + 'px');
            spark.style.setProperty('--vy', vy + 'px');
            spark.style.animation = 'sparkle 0.8s ease-out forwards';
            
            container.appendChild(spark);
            setTimeout(() => {
                if(spark.parentNode) spark.parentNode.removeChild(spark);
            }, 800);
        }, 80);
    }
    
    function updateFooterBookBtn() {
        const targets = [
            { btn: document.getElementById('footerBookBtn'), txt: document.getElementById('footerBookBtnText'), preloader: document.getElementById('footerBookBtnPreloader') },
            { btn: document.getElementById('headerBookBtn'), txt: document.getElementById('headerBookBtnText'), preloader: document.getElementById('headerBookBtnPreloader') }
        ];

        targets.forEach(t => {
            if (!t.btn || !t.preloader) return;

            if (absoluteNearestDate && nearestSlotData) {
                const dayOfWeek = absoluteNearestDate.toLocaleDateString('en-US', { weekday: 'long' });
                
                let htmlContent = '';
                
                if (t.btn.id === 'headerBookBtn') {
                    // Header button: Original format (Line 1: Slot!, Line 2: Day, Time)
                    let timeStr = '';
                    if (nearestSlotData && nearestSlotData.text) {
                        timeStr = nearestSlotData.text.split(/[-]/)[0].trim();
                    }
                    const slotWord = nearestSlotData ? 'Slot' : 'Slots';
                    htmlContent = timeStr 
                        ? `Available ${slotWord}!<br><span style="font-size: 0.95rem; font-weight: 600; opacity: 0.95;">${dayOfWeek} at ${timeStr}</span>` 
                        : `Available ${slotWord}!<br><span style="font-size: 0.9rem; font-weight: 400; opacity: 0.9;">${dayOfWeek}</span>`;
                } else {
                    // Footer button: 3-line format
                    let lastTimeStr = '';
                    const fallbackSlot = nearestDayLastSlotData || nearestSlotData;
                    if (fallbackSlot && fallbackSlot.text) {
                        lastTimeStr = fallbackSlot.text.split(/[-]/)[0].trim();
                    }
                    
                    htmlContent = `Available Slot!<br>` +
                                 `<span style="font-size: 2.2rem; font-weight: 800; display: block; margin: 5px 0; line-height: 1;">${lastTimeStr}</span>` +
                                 `<span style="font-size: 0.9rem; font-weight: 400; opacity: 0.9;">${dayOfWeek}</span>`;
                }
                
                t.preloader.style.transition = 'opacity 0.5s';
                t.preloader.style.opacity = '0';
                t.preloader.style.transform = 'scale(0.9)';
                t.preloader.style.pointerEvents = 'none';

                t.txt.innerHTML = htmlContent;
                t.btn.style.transition = 'opacity 0.5s, transform 0.5s';
                t.btn.style.opacity = '1';
                t.btn.style.transform = 'scale(1)';
                t.btn.style.pointerEvents = 'auto';

                if (!t.btn.dataset.sparksInit) {
                    createSparks(t.btn);
                    t.btn.dataset.sparksInit = 'true';
                }
            } else {
                // No data yet  show preloader, set 4-sec error timer
                t.preloader.style.opacity = '1';
                t.preloader.style.transform = 'scale(1)';
                t.preloader.style.pointerEvents = 'none';
                t.btn.style.opacity = '0';
                t.btn.style.pointerEvents = 'none';

                // Cancel any previously scheduled error timer for this target
                if (t._errorTimer) {
                    clearTimeout(t._errorTimer);
                    t._errorTimer = null;
                    // Reset error state if re-trying
                    t.preloader.classList.remove('book-btn-preloader--error');
                    const svg = t.preloader.querySelector('.book-btn-preloader__svg');
                    if (svg) svg.style.animation = '';
                    const errText = t.preloader.querySelector('.book-btn-preloader__text');
                    if (errText) { errText.textContent = 'Loading...'; errText.style.color = ''; errText.style.display = 'none'; }
                }

                t._errorTimer = setTimeout(() => {
                    t.preloader.classList.add('book-btn-preloader--error');
                    const svg = t.preloader.querySelector('.book-btn-preloader__svg');
                    if (svg) svg.style.animation = 'none';
                    const errText = t.preloader.querySelector('.book-btn-preloader__text');
                    if (errText) {
                        errText.innerHTML = "SLOT NOT FOUND"; // Requested by user
                        errText.style.color = '#ff3333';
                        errText.style.fontWeight = 'bold';
                        errText.style.letterSpacing = '1px';
                        errText.style.fontSize = '0.9rem'; // Slightly smaller to fit "SLOT NOT FOUND"
                        errText.style.display = 'flex'; // Use flex to center properly
                        errText.style.opacity = '1';
                        // Keep text stationary inside centered circle, do not offset since flex is active
                        errText.style.transform = 'none'; 
                    }
                }, 20000); // Wait 20 seconds: 14s fill + 3s wait + 3s glow
            }
        });
    }

    function bookNearestSlot() {
        if (absoluteNearestDate && nearestSlotData) {
            selectedDate = absoluteNearestDate;
            openBookingModal(nearestSlotData);
        } else {
            scrollToCalendar();
        }
    }

    function bookNearestSlotLast(triggerAttach = false) {
        if (absoluteNearestDate && nearestDayLastSlotData) {
            selectedDate = absoluteNearestDate;
            openBookingModal(nearestDayLastSlotData, triggerAttach);
        } else {
            scrollToCalendar();
        }
    }



    // Periodic Progress Bar Scan
    setInterval(() => {
        const separator = document.getElementById('loadingSeparator');
        if (separator && !separator.classList.contains('loading-separator--active')) {
            separator.classList.add('loading-separator--active');
            setTimeout(() => {
                separator.classList.remove('loading-separator--active');
            }, 3000); // Pulse for 3 seconds
        }
    }, 18000); // Every ~18 seconds

    // Custom Select Initialization
    function initializeCustomSelects() {
        const selectElement = document.getElementById('customSelect');
        if (!selectElement) return;
        
        const trigger = selectElement.querySelector('.custom-select__trigger');
        const options = selectElement.querySelectorAll('.custom-option');
        const hiddenInput = document.getElementById('serviceInput');
        const wrapper = selectElement.closest('.custom-select-wrapper');
        trigger.addEventListener('click', (e) => {
            e.preventDefault();
            selectElement.classList.toggle('open');
        });
        options.forEach(option => {
            option.addEventListener('click', () => {
                const value = option.getAttribute('data-value') || option.textContent;
                const text = option.textContent.trim();
                
                // Update trigger text
                trigger.querySelector('span').textContent = text;
                
                if (hiddenInput) hiddenInput.value = text;
                
                options.forEach(opt => opt.classList.remove('selected'));
                option.classList.add('selected');
                
                selectElement.classList.remove('open');
            });
        });
        document.addEventListener('click', (e) => {
            if (!wrapper.contains(e.target)) {
                selectElement.classList.remove('open');
            }
        });
    }

    function adjustDynamicText() {
        const elements = document.querySelectorAll('.dynamic-text');
        elements.forEach(el => {
            el.style.fontSize = ''; // Reset to CSS value
            
            if (el.scrollWidth > el.clientWidth) {
                const style = window.getComputedStyle(el);
                const currentSize = parseFloat(style.fontSize);
                const rootSize = parseFloat(window.getComputedStyle(document.documentElement).fontSize);
                const ratio = el.clientWidth / el.scrollWidth;
                const newRemSize = (currentSize * ratio * 0.95) / rootSize;
                el.style.fontSize = newRemSize + 'rem';
            }
        });
    }

    // (Load listener consolidated above)

    window.addEventListener('resize', adjustDynamicText);// ------------------------------------------------------------------
    // AUTO-HIDING TOP BAR
    // ------------------------------------------------------------------
    const topBar = document.querySelector('.top-bar');
    const bottomBar = document.querySelector('.bottom-bar');
    let lastScrollTop = 0;
    let scrollTimeout;

    function hideBars() {
        if (!document.querySelector('.modal--active')) {
            if (topBar) topBar.classList.remove('top-bar--visible');
            if (bottomBar) bottomBar.classList.remove('bottom-bar--visible');
        }
    }

    function startHideTimer() {
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(hideBars, 10000);
    }


    window.addEventListener('scroll', () => {
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;
        

        // On any scroll, show the bars.
        if (topBar) topBar.classList.add('top-bar--visible');
        if (bottomBar) bottomBar.classList.add('bottom-bar--visible');
        
        // Reset the timer to hide it after a period of inactivity.
        startHideTimer();
        
        lastScrollTop = currentScroll <= 0 ? 0 : currentScroll;
    }, { passive: true });

    if (topBar) {
        topBar.addEventListener('mouseenter', () => clearTimeout(scrollTimeout));
        topBar.addEventListener('mouseleave', startHideTimer);
    }
    if (bottomBar) {
        bottomBar.addEventListener('mouseenter', () => clearTimeout(scrollTimeout));
        bottomBar.addEventListener('mouseleave', startHideTimer);
    }

    // Scroll Fade-in Observer
    // Scroll Fade-in Observer
    var revealObserver;

    function triggerReveal() {
        var revealElements = document.querySelectorAll('.fade-in-section, .blur-in-section, .fade-in-delayed');
        if (!revealElements.length) return;

        if (!revealObserver && window.IntersectionObserver) {
            revealObserver = new IntersectionObserver(function(entries, observerInstance) {
                entries.forEach(function(entry) {
                    if (entry.isIntersecting) {
                        entry.target.classList.remove('is-hidden');
                        entry.target.classList.add('is-visible');
                        observerInstance.unobserve(entry.target);
                    }
                });
            }, {
                root: null,
                rootMargin: '0px 0px 200px 0px',
                threshold: 0
            });
        }

        revealElements.forEach(function(el) {
            // Initial state: hide if not in view
            var rect = el.getBoundingClientRect();
            if (rect.top > window.innerHeight) {
                el.classList.add('is-hidden');
            } else {
                el.classList.add('is-visible');
            }

            if (revealObserver) {
                revealObserver.observe(el);
            }
        });
    }

    // Run trigger
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', triggerReveal);
    } else {
        triggerReveal();
    }
    window.addEventListener('load', triggerReveal);


    // Geolocation Logging for Directions
    function logDirectionsClick() {
        captureGeolocation(
            (link) => logEvent("Directions Clicked", `Location: ${link}`, false, link),
            (err) => logEvent("Directions Clicked", `Location capture failed: ${err}`)
        );
    }
</script>
</body>
</html>